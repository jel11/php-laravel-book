# –ì–ª–∞–≤–∞ 9.5: Seeders –∏ Factories ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ñ–µ–π–∫–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## –í–≤–µ–¥–µ–Ω–∏–µ: –ó–∞—á–µ–º –Ω–∞–º –Ω—É–∂–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å: —Ç—ã —Å–æ–∑–¥–∞–ª –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä. –ï—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, –º–æ–¥–µ–ª–∏, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã. –ó–∞–ø—É—Å–∫–∞–µ—à—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî –ø—É—Å—Ç–æ—Ç–∞. –ù–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∏ —á–∞—Ç–æ–≤, –Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –ß—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é:

- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–æ–∑–¥–∞—Ç—å –º–µ–∂–¥—É –Ω–∏–º–∏ —á–∞—Ç—ã
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ—Ç–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã, –∞–≤–∞—Ç–∞—Ä–∫–∏...

–ù–∞ —ç—Ç–æ —É–π–¥—É—Ç **—á–∞—Å—ã**. –ò –≤—Å—ë —ç—Ç–æ –ø—Ä–∏–¥—ë—Ç—Å—è –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ç—ã —Å–±—Ä–æ—Å–∏—à—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í Laravel –¥–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –¥–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:

- **Factories** ‚Äî —à–∞–±–ª–æ–Ω—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π —Å —Ñ–µ–π–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- **Seeders** ‚Äî —Å–∫—Ä–∏–ø—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–ø–æ–ª–Ω—è—é—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

## 1. Factories ‚Äî —Ñ–∞–±—Ä–∏–∫–∏ –º–æ–¥–µ–ª–µ–π

### 1.1 –ß—Ç–æ —Ç–∞–∫–æ–µ Factory?

Factory ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç, **–∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–¥–µ–ª–∏** —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ —Ñ–µ–π–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

**–°–æ–∑–¥–∞–Ω–∏–µ Factory:**

```bash
php artisan make:factory UserFactory
```

–§–∞–π–ª –ø–æ—è–≤–∏—Ç—Å—è –≤ `database/factories/UserFactory.php`:

```php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

class UserFactory extends Factory
{
    /**
     * –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –º–æ–¥–µ–ª–∏
     */
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => Hash::make('password'), // –í—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø–∞—Ä–æ–ª–µ–º "password"
            'remember_token' => Str::random(10),
        ];
    }
    
    /**
     * –°–æ—Å—Ç–æ—è–Ω–∏–µ: –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π email
     */
    public function unverified(): static
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => null,
        ]);
    }
}
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

- `fake()` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ö–µ–ª–ø–µ—Ä Laravel, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç Faker (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–µ–π–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
- `definition()` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –º–æ–¥–µ–ª–∏
- `state()` ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–∞—Ä–∏–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–≥–æ email")

### 1.2 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Factory

**–°–æ–∑–¥–∞—Ç—å –æ–¥–Ω—É –º–æ–¥–µ–ª—å:**

```php
use App\Models\User;

$user = User::factory()->create();
// –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –°–û–•–†–ê–ù–Ø–ï–¢ –≤ –ë–î
```

**–°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ:**

```php
$users = User::factory()->count(50)->create();
// 50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î
```

**–°–æ–∑–¥–∞—Ç—å –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î (–¥–ª—è —Ç–µ—Å—Ç–æ–≤):**

```php
$user = User::factory()->make();
// –°–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç User, –Ω–æ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–∞–∑—É
```

**–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç—ã:**

```php
$admin = User::factory()->create([
    'name' => 'Admin',
    'email' => 'admin@example.com',
    'role' => 'admin'
]);
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è (states):**

```php
$unverified = User::factory()->unverified()->create();
// email_verified_at –±—É–¥–µ—Ç null
```

### 1.3 Faker ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–µ–π–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

Laravel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É **Faker** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–º–µ—Ä—ã –º–µ—Ç–æ–¥–æ–≤ Faker:**

```php
// –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
fake()->name()              // "John Doe"
fake()->firstName()         // "Jane"
fake()->lastName()          // "Smith"
fake()->email()             // "email@example.com"
fake()->safeEmail()         // "email@example.org" (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ–º–µ–Ω)
fake()->phoneNumber()       // "+1-555-123-4567"

// –ê–¥—Ä–µ—Å–∞
fake()->address()           // "123 Main St, Apt 4B, New York, NY 10001"
fake()->city()              // "Los Angeles"
fake()->country()           // "United States"
fake()->postcode()          // "90210"

// –î–∞—Ç—ã
fake()->dateTimeBetween('-1 year', 'now')   // –°–ª—É—á–∞–π–Ω–∞—è –¥–∞—Ç–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥
fake()->dateTime()                           // –°–ª—É—á–∞–π–Ω–∞—è –¥–∞—Ç–∞
fake()->date()                               // "2024-03-15"

// –¢–µ–∫—Å—Ç
fake()->sentence()          // "Lorem ipsum dolor sit amet."
fake()->paragraph()         // –¶–µ–ª—ã–π –∞–±–∑–∞—Ü —Ç–µ–∫—Å—Ç–∞
fake()->text(200)           // –¢–µ–∫—Å—Ç –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤
fake()->words(5, true)      // "hello world foo bar baz"

// –ß–∏—Å–ª–∞
fake()->numberBetween(1, 100)       // 42
fake()->randomFloat(2, 0, 100)      // 45.67
fake()->boolean()                   // true/false

// –ò–Ω—Ç–µ—Ä–Ω–µ—Ç
fake()->url()               // "https://example.com"
fake()->domainName()        // "example.com"
fake()->ipv4()              // "192.168.1.1"
fake()->userAgent()         // "Mozilla/5.0..."

// –ö–∞—Ä—Ç–∏–Ω–∫–∏ (URL —Å placeholder-—Å–µ—Ä–≤–∏—Å–∞)
fake()->imageUrl(640, 480, 'cats')  // "https://via.placeholder.com/640x480.png/cats"

// –°–ª—É—á–∞–π–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
fake()->randomElement(['cat', 'dog', 'bird'])   // "dog"
fake()->randomElements(['a', 'b', 'c'], 2)      // ['a', 'c']
```

**–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫):**

```php
// –í config/app.php
'faker_locale' => 'ru_RU',

// –¢–µ–ø–µ—Ä—å:
fake()->name()  // "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"
fake()->city()  // "–ú–æ—Å–∫–≤–∞"
```

### 1.4 –°–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ –≤ Factories

**–ü—Ä–∏–º–µ—Ä: Post –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç User**

```php
// database/factories/PostFactory.php
class PostFactory extends Factory
{
    public function definition(): array
    {
        return [
            'user_id' => User::factory(),  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç User
            'title' => fake()->sentence(),
            'content' => fake()->paragraphs(3, true),
            'published_at' => fake()->dateTimeBetween('-6 months', 'now'),
        ];
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```php
// –°–æ–∑–¥–∞—Å—Ç User –ò Post
$post = Post::factory()->create();

// –°–æ–∑–¥–∞—Ç—å Post –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ User
$user = User::find(1);
$post = Post::factory()->create(['user_id' => $user->id]);

// –ò–ª–∏ —á–µ—Ä–µ–∑ —Å–≤—è–∑—å (—É–¥–æ–±–Ω–µ–µ):
$post = $user->posts()->create(Post::factory()->raw());
```

**–ü—Ä–∏–º–µ—Ä: User has many Posts**

```php
$user = User::factory()
    ->has(Post::factory()->count(10))
    ->create();
// –°–æ–∑–¥–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å 10 –ø–æ—Å—Ç–∞–º–∏
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:**

```php
$user = User::factory()
    ->hasPosts(10)  // –ö–æ—Ä–æ—á–µ!
    ->create();
```

**Many-to-Many (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–æ–ª–∏):**

```php
$user = User::factory()
    ->hasAttached(
        Role::factory()->count(2),
        ['expires_at' => now()->addYear()]  // –î–æ–ø. –ø–æ–ª—è pivot-—Ç–∞–±–ª–∏—Ü—ã
    )
    ->create();
```

### 1.5 –°–æ—Å—Ç–æ—è–Ω–∏—è (States) ‚Äî –≤–∞—Ä–∏–∞—Ü–∏–∏ Factory

```php
class UserFactory extends Factory
{
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'role' => 'user',
            'is_active' => true,
        ];
    }
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ: –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
    public function admin(): static
    {
        return $this->state(fn (array $attributes) => [
            'role' => 'admin',
        ]);
    }
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ: –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π
    public function inactive(): static
    {
        return $this->state(fn (array $attributes) => [
            'is_active' => false,
        ]);
    }
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ: —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–º email
    public function verified(): static
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => now(),
        ]);
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```php
$admin = User::factory()->admin()->create();
$inactive = User::factory()->inactive()->create();

// –ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å:
$inactiveAdmin = User::factory()->admin()->inactive()->create();
```

### 1.6 Callbacks ‚Äî –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

```php
class UserFactory extends Factory
{
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
        ];
    }
    
    public function configure(): static
    {
        return $this->afterCreating(function (User $user) {
            // –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            $user->profile()->create([
                'bio' => fake()->paragraph(),
                'avatar' => fake()->imageUrl(200, 200, 'people'),
            ]);
            
            // –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            $user->teams()->attach(Team::first());
        });
    }
}
```

---

## 2. Seeders ‚Äî –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 2.1 –ß—Ç–æ —Ç–∞–∫–æ–µ Seeder?

Seeder ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π **–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î** —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

**–°–æ–∑–¥–∞–Ω–∏–µ Seeder:**

```bash
php artisan make:seeder UserSeeder
```

–§–∞–π–ª –ø–æ—è–≤–∏—Ç—Å—è –≤ `database/seeders/UserSeeder.php`:

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;

class UserSeeder extends Seeder
{
    public function run(): void
    {
        // –°–æ–∑–¥–∞—Ç—å 50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        User::factory()->count(50)->create();
        
        // –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
        User::factory()->create([
            'name' => 'Admin',
            'email' => 'admin@example.com',
            'role' => 'admin',
        ]);
    }
}
```

### 2.2 DatabaseSeeder ‚Äî –≥–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä

–§–∞–π–ª `database/seeders/DatabaseSeeder.php` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö seeders:

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        // –í—ã–∑—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ seeders
        $this->call([
            UserSeeder::class,
            PostSeeder::class,
            CommentSeeder::class,
        ]);
    }
}
```

**–ó–∞–ø—É—Å–∫:**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ seeders
php artisan db:seed

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π seeder
php artisan db:seed --class=UserSeeder

# –°–±—Ä–æ—Å–∏—Ç—å –ë–î –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å seeders (—Å–≤–µ–∂–∏–π —Å—Ç–∞—Ä—Ç)
php artisan migrate:fresh --seed
```

### 2.3 –ü—Ä–∏–º–µ—Ä: –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Seeder –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;
use App\Models\Chat;
use App\Models\Message;

class MessengerSeeder extends Seeder
{
    public function run(): void
    {
        // 1. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        $users = User::factory()->count(20)->create();
        
        // 2. –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞
        $admin = User::factory()->admin()->create([
            'name' => 'Admin',
            'email' => 'admin@test.com',
        ]);
        
        // 3. –°–æ–∑–¥–∞—Ç—å —á–∞—Ç—ã
        $chats = Chat::factory()->count(15)->create();
        
        // 4. –ü—Ä–∏–≤—è–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ —á–∞—Ç–∞–º (–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º)
        $chats->each(function ($chat) use ($users) {
            // –ö–∞–∂–¥—ã–π —á–∞—Ç ‚Äî 2-5 —Å–ª—É—á–∞–π–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            $chat->users()->attach(
                $users->random(rand(2, 5))->pluck('id')
            );
        });
        
        // 5. –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–∂–¥–æ–º —á–∞—Ç–µ
        $chats->each(function ($chat) {
            $participants = $chat->users;
            
            // 10-50 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ
            Message::factory()->count(rand(10, 50))->create([
                'chat_id' => $chat->id,
                'user_id' => $participants->random()->id,
            ]);
        });
    }
}
```

### 2.4 –£—Å–ª–æ–≤–Ω—ã–µ seeders (–¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π)

```php
class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        // –¢–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
        if (app()->environment('local')) {
            $this->call([
                TestUserSeeder::class,
                FakeDataSeeder::class,
            ]);
        }
        
        // –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ ‚Äî —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        $this->call([
            RoleSeeder::class,
            SettingSeeder::class,
        ]);
    }
}
```

### 2.5 Seeders —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```php
class RoleSeeder extends Seeder
{
    public function run(): void
    {
        $roles = ['admin', 'moderator', 'user'];
        
        foreach ($roles as $role) {
            Role::firstOrCreate(['name' => $role]);
            // –°–æ–∑–¥–∞—Å—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–æ–ª–∏ –µ—â—ë –Ω–µ—Ç
        }
    }
}
```

---

## 3. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏

### 3.1 Sequence ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

```php
$users = User::factory()
    ->count(10)
    ->sequence(
        ['role' => 'admin'],
        ['role' => 'moderator'],
        ['role' => 'user'],
    )
    ->create();
// –†–æ–ª–∏ –±—É–¥—É—Ç —á–µ—Ä–µ–¥–æ–≤–∞—Ç—å—Å—è: admin, moderator, user, admin, moderator...
```

**–ò–ª–∏ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π:**

```php
$posts = Post::factory()
    ->count(10)
    ->sequence(fn (Sequence $sequence) => [
        'order' => $sequence->index + 1,  // 1, 2, 3, 4...
    ])
    ->create();
```

### 3.2 Recycle ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏

–ë–µ–∑ `recycle()` ‚Äî –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π User:

```php
Post::factory()->count(100)->create();
// –°–æ–∑–¥–∞—Å—Ç 100 –ø–æ—Å—Ç–æ–≤ –∏ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

–° `recycle()` ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ User:

```php
$users = User::factory()->count(5)->create();

Post::factory()
    ->count(100)
    ->recycle($users)
    ->create();
// 100 –ø–æ—Å—Ç–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—Å—è –º–µ–∂–¥—É 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
```

### 3.3 Cross ‚Äî —Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º

```php
$users = User::factory()->count(10)->create();
$roles = Role::factory()->count(3)->create();

// –°–≤—è–∑–∞—Ç—å –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å 1-2 —Ä–æ–ª—è–º–∏
$users->each(function ($user) use ($roles) {
    $user->roles()->attach(
        $roles->random(rand(1, 2))->pluck('id')
    );
});
```

### 3.4 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –º–∞—Å—Å–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞

–ú–µ–¥–ª–µ–Ω–Ω–æ (100 INSERT –∑–∞–ø—Ä–æ—Å–æ–≤):

```php
User::factory()->count(100)->create();
```

–ë—ã—Å—Ç—Ä–µ–µ (1 INSERT –∑–∞–ø—Ä–æ—Å):

```php
$users = User::factory()->count(100)->make()->toArray();
User::insert($users);  // –ú–∞—Å—Å–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞
```

‚ö†Ô∏è **–ú–∏–Ω—É—Å**: –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ–±—ã—Ç–∏—è –º–æ–¥–µ–ª–∏ (`creating`, `created`), –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –Ω–µ –≤–µ—Ä–Ω—É—Ç—å ID.

---

## 4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### 4.1 –ë–ª–æ–≥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

```php
// PostFactory.php
class PostFactory extends Factory
{
    public function definition(): array
    {
        return [
            'user_id' => User::factory(),
            'title' => fake()->sentence(),
            'slug' => fake()->slug(),
            'content' => fake()->paragraphs(5, true),
            'published_at' => fake()->boolean(80) 
                ? fake()->dateTimeBetween('-1 year', 'now') 
                : null,
        ];
    }
    
    public function published(): static
    {
        return $this->state(fn () => [
            'published_at' => fake()->dateTimeBetween('-1 year', 'now'),
        ]);
    }
    
    public function draft(): static
    {
        return $this->state(fn () => [
            'published_at' => null,
        ]);
    }
}

// CommentFactory.php
class CommentFactory extends Factory
{
    public function definition(): array
    {
        return [
            'post_id' => Post::factory(),
            'user_id' => User::factory(),
            'content' => fake()->paragraph(),
            'approved' => fake()->boolean(90),
        ];
    }
}

// BlogSeeder.php
class BlogSeeder extends Seeder
{
    public function run(): void
    {
        $users = User::factory()->count(10)->create();
        
        $posts = Post::factory()
            ->count(30)
            ->recycle($users)
            ->create();
        
        // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞
        $posts->each(function ($post) use ($users) {
            Comment::factory()
                ->count(rand(0, 15))
                ->recycle($users)
                ->create([
                    'post_id' => $post->id,
                ]);
        });
    }
}
```

### 4.2 –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω

```php
// ProductFactory.php
class ProductFactory extends Factory
{
    public function definition(): array
    {
        return [
            'name' => fake()->words(3, true),
            'description' => fake()->paragraph(),
            'price' => fake()->randomFloat(2, 10, 1000),
            'stock' => fake()->numberBetween(0, 100),
            'category_id' => Category::factory(),
            'image_url' => fake()->imageUrl(400, 400, 'tech'),
        ];
    }
    
    public function outOfStock(): static
    {
        return $this->state(fn () => ['stock' => 0]);
    }
}

// OrderFactory.php
class OrderFactory extends Factory
{
    public function definition(): array
    {
        return [
            'user_id' => User::factory(),
            'status' => fake()->randomElement(['pending', 'paid', 'shipped', 'delivered']),
            'total' => 0,  // –í—ã—á–∏—Å–ª–∏–º –ø–æ–∑–∂–µ
            'created_at' => fake()->dateTimeBetween('-6 months', 'now'),
        ];
    }
}

// ShopSeeder.php
class ShopSeeder extends Seeder
{
    public function run(): void
    {
        $categories = Category::factory()->count(5)->create();
        
        $products = Product::factory()
            ->count(50)
            ->recycle($categories)
            ->create();
        
        $users = User::factory()->count(20)->create();
        
        // –ó–∞–∫–∞–∑—ã
        $users->each(function ($user) use ($products) {
            $orderCount = rand(0, 5);
            
            for ($i = 0; $i < $orderCount; $i++) {
                $order = Order::factory()->create([
                    'user_id' => $user->id,
                ]);
                
                // –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ
                $orderProducts = $products->random(rand(1, 5));
                $total = 0;
                
                foreach ($orderProducts as $product) {
                    $quantity = rand(1, 3);
                    $price = $product->price;
                    
                    $order->products()->attach($product->id, [
                        'quantity' => $quantity,
                        'price' => $price,
                    ]);
                    
                    $total += $price * $quantity;
                }
                
                $order->update(['total' => $total]);
            }
        });
    }
}
```

---

## 5. –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### ‚ùå –û—à–∏–±–∫–∞ 1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

```php
// –ü–õ–û–•–û
User::factory()->count(100)->create([
    'email' => 'same@email.com'  // –í—Å–µ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–¥–Ω–∏–º email ‚Äî –æ—à–∏–±–∫–∞!
]);

// –•–û–†–û–®–û
User::factory()->count(100)->create();
// Faker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ email —á–µ—Ä–µ–∑ unique()
```

### ‚ùå –û—à–∏–±–∫–∞ 2: –ó–∞–±—ã–ª–∏ –ø—Ä–æ foreign keys

```php
// –ü–õ–û–•–û ‚Äî —É–ø–∞–¥—ë—Ç, –µ—Å–ª–∏ user_id –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
Post::factory()->create(['user_id' => 9999]);

// –•–û–†–û–®–û
Post::factory()->create(['user_id' => User::factory()]);
```

### ‚ùå –û—à–∏–±–∫–∞ 3: –°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–π seeder

```php
// –ü–õ–û–•–û ‚Äî 1000 –∑–∞–ø—Ä–æ—Å–æ–≤
for ($i = 0; $i < 1000; $i++) {
    User::factory()->create();
}

// –•–û–†–û–®–û
User::factory()->count(1000)->create();
// –ò–ª–∏ –µ—â—ë –±—ã—Å—Ç—Ä–µ–µ:
User::insert(User::factory()->count(1000)->make()->toArray());
```

### ‚ùå –û—à–∏–±–∫–∞ 4: –ù–µ –æ—á–∏—â–∞–µ—Ç–µ –ë–î –ø–µ—Ä–µ–¥ seeding

```bash
# –ü–õ–û–•–û
php artisan db:seed  # –î–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º

# –•–û–†–û–®–û
php artisan migrate:fresh --seed  # –ß–∏—Å—Ç–∞—è –ë–î + seeders
```

---

## 6. Best Practices

### ‚úÖ 1. –û–¥–∏–Ω Seeder = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

```php
// –ü–õ–û–•–û
class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        User::factory()->count(100)->create();
        Post::factory()->count(500)->create();
        Comment::factory()->count(2000)->create();
        // –í—Å—ë –≤ –æ–¥–Ω–æ–π –∫—É—á–µ
    }
}

// –•–û–†–û–®–û
class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        $this->call([
            UserSeeder::class,
            PostSeeder::class,
            CommentSeeder::class,
        ]);
    }
}
```

### ‚úÖ 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

```php
// –ü–õ–û–•–û
User::factory()->create(['role' => 'admin']);
User::factory()->create(['role' => 'moderator']);

// –•–û–†–û–®–û
User::factory()->admin()->create();
User::factory()->moderator()->create();
```

### ‚úÖ 3. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

```php
// –ü–õ–û–•–û
'created_at' => now()  // –í—Å–µ –∑–∞–ø–∏—Å–∏ —Å –æ–¥–Ω–æ–π –¥–∞—Ç–æ–π

// –•–û–†–û–®–û
'created_at' => fake()->dateTimeBetween('-1 year', 'now')
```

### ‚úÖ 4. –ö–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É

```php
public function run(): void
{
    // –°–æ–∑–¥–∞—ë–º 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–∞–∂–¥—ã–π —Å 5-10 –ø–æ—Å—Ç–∞–º–∏
    $users = User::factory()
        ->count(10)
        ->has(Post::factory()->count(rand(5, 10)))
        ->create();
    
    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞ —Å–æ–∑–¥–∞—ë–º 0-5 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    Post::all()->each(function ($post) use ($users) {
        Comment::factory()
            ->count(rand(0, 5))
            ->create([
                'post_id' => $post->id,
                'user_id' => $users->random()->id,
            ]);
    });
}
```

---

## 7. –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: –ë–∞–∑–æ–≤–∞—è —Ñ–∞–±—Ä–∏–∫–∞
–°–æ–∑–¥–∞–π —Ñ–∞–±—Ä–∏–∫—É –¥–ª—è –º–æ–¥–µ–ª–∏ `Product` —Å –ø–æ–ª—è–º–∏:
- `name` (3-5 —Å–ª–æ–≤)
- `description` (–∞–±–∑–∞—Ü —Ç–µ–∫—Å—Ç–∞)
- `price` (–æ—Ç 100 –¥–æ 10000)
- `in_stock` (boolean, 80% true)

### –ó–∞–¥–∞–Ω–∏–µ 2: –°–≤—è–∑–∏
–°–æ–∑–¥–∞–π —Ñ–∞–±—Ä–∏–∫–∏ –¥–ª—è `Author` –∏ `Book`. –£ –∞–≤—Ç–æ—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ –∫–Ω–∏–≥. –°–æ–∑–¥–∞–π —Å–∏–¥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:
- 10 –∞–≤—Ç–æ—Ä–æ–≤
- –£ –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ—Ä–∞ 2-5 –∫–Ω–∏–≥

### –ó–∞–¥–∞–Ω–∏–µ 3: –°–æ—Å—Ç–æ—è–Ω–∏—è
–†–∞—Å—à–∏—Ä—å —Ñ–∞–±—Ä–∏–∫—É `Product` —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏:
- `discount()` ‚Äî —Ü–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π 20%
- `featured()` ‚Äî `is_featured = true`
- `outOfStock()` ‚Äî `in_stock = false`

### –ó–∞–¥–∞–Ω–∏–µ 4: –°–ª–æ–∂–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
- Users (—á–∏—Ç–∞—Ç–µ–ª–∏)
- Books (–∫–Ω–∏–≥–∏)
- Borrows (–∑–∞–ø–∏—Å–∏ –æ –≤—ã–¥–∞—á–µ –∫–Ω–∏–≥)

–°–∏–¥–µ—Ä –¥–æ–ª–∂–µ–Ω:
1. –°–æ–∑–¥–∞—Ç—å 20 —á–∏—Ç–∞—Ç–µ–ª–µ–π
2. –°–æ–∑–¥–∞—Ç—å 100 –∫–Ω–∏–≥
3. –°–æ–∑–¥–∞—Ç—å 50 –∑–∞–ø–∏—Å–µ–π –æ –≤—ã–¥–∞—á–µ (—Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ + –∫–Ω–∏–≥–∏)
4. 70% –∑–∞–ø–∏—Å–µ–π ‚Äî –∫–Ω–∏–≥–∞ —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ (`returned_at` != null)
5. 30% ‚Äî –µ—â—ë –Ω–∞ —Ä—É–∫–∞—Ö (`returned_at` = null)

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Factories –∏ Seeders** ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–¥–æ–±—Å—Ç–≤–æ, —ç—Ç–æ **–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å** –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç:

‚úÖ –ë—ã—Å—Ç—Ä–æ –Ω–∞–ø–æ–ª–Ω—è—Ç—å –ë–î —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏  
‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö  
‚úÖ –õ–µ–≥–∫–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –±–∞–∑—É  
‚úÖ –î–µ–ª–∏—Ç—å—Å—è —Ç–µ—Å—Ç–æ–≤—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º —Å –∫–æ–º–∞–Ω–¥–æ–π  
‚úÖ –ü–∏—Å–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏  

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ì–ª–∞–≤–∞ 10.1 ‚Äî –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ Laravel. –ù–∞—É—á–∏–º—Å—è –∑–∞—â–∏—â–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã –≤—Ö–æ–¥–∞ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞.

–£–¥–∞—á–∏! üöÄ