# –ì–ª–∞–≤–∞ 11.1: –í–≤–µ–¥–µ–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –∑–∞—á–µ–º —Ç–µ—Å—Ç—ã, –≤–∏–¥—ã —Ç–µ—Å—Ç–æ–≤, PHPUnit

## üéØ –¶–µ–ª–∏ –≥–ª–∞–≤—ã

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–æ–π –≥–ª–∞–≤—ã —Ç—ã —Å–º–æ–∂–µ—à—å:
- –ü–æ–Ω–∏–º–∞—Ç—å, –∑–∞—á–µ–º –Ω—É–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –†–∞–∑–ª–∏—á–∞—Ç—å –≤–∏–¥—ã —Ç–µ—Å—Ç–æ–≤ –∏ –∑–Ω–∞—Ç—å, –∫–æ–≥–¥–∞ –∫–∞–∫–∏–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å PHPUnit
- –ü–∏—Å–∞—Ç—å —Å–≤–æ–∏ –ø–µ—Ä–≤—ã–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
- –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –∏ —á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## üìñ –¢–µ–æ—Ä–∏—è

### –ü–æ—á–µ–º—É —Ç–µ—Å—Ç—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã

–ü—Ä–µ–¥—Å—Ç–∞–≤—å: —Ç—ã –¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—É—é —Ñ–∏—á—É –≤ —Å–≤–æ–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä. –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ. –ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é —Ñ–∏–∫—Å–∏—à—å –±–∞–≥ –≤ —Å–∏—Å—Ç–µ–º–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏... –≤–Ω–µ–∑–∞–ø–Ω–æ –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π. –¢—ã –æ–± —ç—Ç–æ–º —É–∑–Ω–∞–µ—à—å —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª –≥–Ω–µ–≤–Ω—ã–π –æ—Ç–∑—ã–≤.

**–ë–µ–∑ —Ç–µ—Å—Ç–æ–≤:**
```
–ö–æ–¥ ‚Üí –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí –î–µ–ø–ª–æ–π ‚Üí üî• –ß—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å –≤ production
```

**–° —Ç–µ—Å—Ç–∞–º–∏:**
```
–ö–æ–¥ ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã ‚Üí ‚ùå –¢–µ—Å—Ç—ã —É–ø–∞–ª–∏ ‚Üí –§–∏–∫—Å ‚Üí ‚úÖ –í—Å–µ –∑–µ–ª–µ–Ω–æ ‚Üí –î–µ–ø–ª–æ–π
```

### –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤

**1. –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö**
```php
// –¢—ã –º–µ–Ω—è–µ—à—å calculateDiscount()
// –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—Ç, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–ª–æ—Å—å

public function test_discount_calculation()
{
    $order = new Order(['total' => 1000]);
    $this->assertEquals(900, $order->calculateDiscount(10));
}
```

**2. –ñ–∏–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
```php
// –¢–µ—Å—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ö–ê–ö –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–¥
public function test_user_can_send_message_only_to_friends()
{
    $user = User::factory()->create();
    $stranger = User::factory()->create();
    
    $result = $user->sendMessage($stranger, 'Hello');
    
    $this->assertFalse($result);
    $this->assertDatabaseMissing('messages', [
        'sender_id' => $user->id,
        'receiver_id' => $stranger->id
    ]);
}
```

**3. –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**
–í–º–µ—Å—Ç–æ 5 –º–∏–Ω—É—Ç —Ä—É—á–Ω–æ–≥–æ –∫–ª–∏–∫–∞–Ω—å—è ‚Äî 2 —Å–µ–∫—É–Ω–¥—ã –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤.

**4. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ —Å—Ç—Ä–∞—Ö–∞**
```php
// –•–æ—á–µ—à—å –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤–µ—Å—å –º–µ—Ç–æ–¥? –¢–µ—Å—Ç—ã —Å–∫–∞–∂—É—Ç, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å
// –ë–´–õ–û:
public function calculateTotal() {
    return array_sum($this->items) + $this->tax;
}

// –°–¢–ê–õ–û:
public function calculateTotal() {
    return collect($this->items)->sum() + $this->getTax();
}

// –¢–µ—Å—Ç—ã –æ—Å—Ç–∞–ª–∏—Å—å —Ç–µ –∂–µ ‚Äî –µ—Å–ª–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω
```

### –ö–æ–≥–¥–∞ —Ç–µ—Å—Ç—ã –ù–ï –Ω—É–∂–Ω—ã (–¥–∞, –±—ã–≤–∞–µ—Ç)

- **–ü—Ä–æ—Ç–æ—Ç–∏–ø—ã** ‚Äî –∫–æ–¥ –∂–∏–≤–µ—Ç 2 –¥–Ω—è, —Ç–µ—Å—Ç—ã –¥–æ–ª—å—à–µ –ø–∏—Å–∞—Ç—å
- **–°–∫—Ä–∏–ø—Ç—ã-–æ–¥–Ω–æ–¥–Ω–µ–≤–∫–∏** ‚Äî –ø–∞—Ä—Å–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å—Ç–∏—à—å —Ä–∞–∑
- **–û—á–µ–≤–∏–¥–Ω—ã–π –∫–æ–¥** ‚Äî –≥–µ—Ç—Ç–µ—Ä `getName()` —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–º—ã—Å–ª–∞ –Ω–µ—Ç

–ù–æ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç –∂–∏–≤–µ—Ç –¥–æ–ª—å—à–µ –Ω–µ–¥–µ–ª–∏ ‚Äî —Ç–µ—Å—Ç—ã –æ–∫—É–ø–∞—é—Ç—Å—è.

---

## üîç –í–∏–¥—ã —Ç–µ—Å—Ç–æ–≤ (–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```
        /\
       /  \  E2E Tests (End-to-End)
      /____\  –ú–∞–ª–æ, –º–µ–¥–ª–µ–Ω–Ω—ã–µ, –¥–æ—Ä–æ–≥–∏–µ
     /      \
    / Integr \ Integration Tests
   /  ation   \ –°—Ä–µ–¥–Ω–µ
  /____________\
 /              \
/   Unit Tests   \ –ú–Ω–æ–≥–æ, –±—ã—Å—Ç—Ä—ã–µ, –¥–µ—à–µ–≤—ã–µ
/__________________\
```

### 1. Unit-—Ç–µ—Å—Ç—ã (—é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã)

**–ß—Ç–æ:** –¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏/–º–µ—Ç–æ–¥—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ.

**–ü—Ä–∏–º–µ—Ä:**
```php
class Calculator
{
    public function add($a, $b)
    {
        return $a + $b;
    }
}

// –¢–ï–°–¢
class CalculatorTest extends TestCase
{
    public function test_add_two_numbers()
    {
        $calc = new Calculator();
        $result = $calc->add(2, 3);
        
        $this->assertEquals(5, $result);
    }
}
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- ‚ö° –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–µ (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
- üéØ –¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ–¥–Ω—É –≤–µ—â—å
- üîí –ù–µ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –ë–î/—Ñ–∞–π–ª–∞–º/—Å–µ—Ç–∏
- üì¶ –ò—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫–∏ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 2. Integration Tests (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ)

**–ß—Ç–æ:** –ü—Ä–æ–≤–µ—Ä—è—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

**–ü—Ä–∏–º–µ—Ä:**
```php
// –ü—Ä–æ–≤–µ—Ä—è–µ–º: –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ‚Üí —Å–µ—Ä–≤–∏—Å ‚Üí —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Üí –ë–î
public function test_user_registration_flow()
{
    $data = [
        'email' => 'test@example.com',
        'password' => 'secret123'
    ];
    
    $response = $this->post('/register', $data);
    
    $response->assertStatus(201);
    $this->assertDatabaseHas('users', [
        'email' => 'test@example.com'
    ]);
}
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- üê¢ –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ (—Å–µ–∫—É–Ω–¥—ã)
- üîó –ü—Ä–æ–≤–µ—Ä—è—é—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- üíæ –ú–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ë–î (–∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—É—é)

### 3. E2E Tests (—Å–∫–≤–æ–∑–Ω—ã–µ —Ç–µ—Å—Ç—ã)

**–ß—Ç–æ:** –°–∏–º—É–ª–∏—Ä—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

**–ü—Ä–∏–º–µ—Ä (Laravel Dusk):**
```php
public function test_user_can_send_message()
{
    $this->browse(function (Browser $browser) {
        $browser->visit('/login')
                ->type('email', 'user@test.com')
                ->type('password', 'password')
                ->press('Login')
                ->waitForText('Welcome')
                ->visit('/chat/1')
                ->type('message', 'Hello!')
                ->press('Send')
                ->waitForText('Hello!');
    });
}
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- üêå –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ (–º–∏–Ω—É—Ç—ã)
- üí∞ –°–ª–æ–∂–Ω—ã–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ
- üé≠ –ü—Ä–æ–≤–µ—Ä—è—é—Ç –≤–µ—Å—å —Å—Ç–µ–∫ (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ + –±—ç–∫–µ–Ω–¥)

### –ü—Ä–∞–≤–∏–ª–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

```
70% ‚Äî Unit-—Ç–µ—Å—Ç—ã
20% ‚Äî Integration-—Ç–µ—Å—Ç—ã
10% ‚Äî E2E-—Ç–µ—Å—Ç—ã
```

---

## ‚öôÔ∏è PHPUnit ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Composer

```bash
composer require --dev phpunit/phpunit
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
vendor/bin/phpunit --version
# PHPUnit 10.5.0 by Sebastian Bergmann and contributors.
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å —Ç–µ—Å—Ç–∞–º–∏

```
project/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ Calculator.php
‚îÇ   ‚îî‚îÄ‚îÄ User.php
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ Unit/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CalculatorTest.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UserTest.php
‚îÇ   ‚îî‚îÄ‚îÄ Integration/
‚îÇ       ‚îî‚îÄ‚îÄ UserRegistrationTest.php
‚îú‚îÄ‚îÄ vendor/
‚îú‚îÄ‚îÄ composer.json
‚îî‚îÄ‚îÄ phpunit.xml
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è phpunit.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<phpunit xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="vendor/phpunit/phpunit/phpunit.xsd"
         bootstrap="vendor/autoload.php"
         colors="true">
    
    <testsuites>
        <testsuite name="Unit">
            <directory>tests/Unit</directory>
        </testsuite>
        <testsuite name="Integration">
            <directory>tests/Integration</directory>
        </testsuite>
    </testsuites>
    
    <source>
        <include>
            <directory>src</directory>
        </include>
    </source>
</phpunit>
```

**–ß—Ç–æ –∑–¥–µ—Å—å:**
- `bootstrap` ‚Äî –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Å–æ–≤ —á–µ—Ä–µ–∑ Composer
- `colors="true"` ‚Äî –∫—Ä–∞—Å–∏–≤—ã–π —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥
- `testsuites` ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤
- `source` ‚Äî –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –ø–æ–∫—Ä—ã–≤–∞—Ç—å —Ç–µ—Å—Ç–∞–º–∏

---

## üíª –ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç –Ω–∞ PHPUnit

### –®–∞–≥ 1: –ö–ª–∞—Å—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**src/StringHelper.php:**
```php
<?php

namespace App;

class StringHelper
{
    public function reverse(string $str): string
    {
        return strrev($str);
    }
    
    public function capitalize(string $str): string
    {
        return ucfirst(strtolower($str));
    }
    
    public function slugify(string $str): string
    {
        $str = strtolower($str);
        $str = preg_replace('/[^a-z0-9]+/', '-', $str);
        return trim($str, '-');
    }
}
```

### –®–∞–≥ 2: –¢–µ—Å—Ç

**tests/Unit/StringHelperTest.php:**
```php
<?php

namespace Tests\Unit;

use PHPUnit\Framework\TestCase;
use App\StringHelper;

class StringHelperTest extends TestCase
{
    private StringHelper $helper;
    
    // –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –ö–ê–ñ–î–´–ú —Ç–µ—Å—Ç–æ–º
    protected function setUp(): void
    {
        parent::setUp();
        $this->helper = new StringHelper();
    }
    
    public function test_reverse_string()
    {
        $result = $this->helper->reverse('hello');
        $this->assertEquals('olleh', $result);
    }
    
    public function test_reverse_empty_string()
    {
        $result = $this->helper->reverse('');
        $this->assertEquals('', $result);
    }
    
    public function test_capitalize_lowercase_word()
    {
        $result = $this->helper->capitalize('hello');
        $this->assertEquals('Hello', $result);
    }
    
    public function test_capitalize_uppercase_word()
    {
        $result = $this->helper->capitalize('HELLO');
        $this->assertEquals('Hello', $result);
    }
    
    public function test_slugify_creates_valid_slug()
    {
        $result = $this->helper->slugify('Hello World 123');
        $this->assertEquals('hello-world-123', $result);
    }
    
    public function test_slugify_removes_special_characters()
    {
        $result = $this->helper->slugify('Hello@World!');
        $this->assertEquals('hello-world', $result);
    }
}
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫

```bash
vendor/bin/phpunit

# PHPUnit 10.5.0 by Sebastian Bergmann and contributors.

......                                                              6 / 6 (100%)

Time: 00:00.012, Memory: 6.00 MB

OK (6 tests, 6 assertions)
```

---

## üîß –ê—Å—Å–µ—Ä—Ü–∏–∏ (assertions) ‚Äî –æ—Å–Ω–æ–≤–∞ —Ç–µ—Å—Ç–æ–≤

### –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```php
// –†–∞–≤–µ–Ω—Å—Ç–≤–æ
$this->assertEquals(5, $result);         // 5 == $result
$this->assertSame(5, $result);           // 5 === $result (—Å—Ç—Ä–æ–∂–µ)

// –ò—Å—Ç–∏–Ω–∞/–õ–æ–∂—å
$this->assertTrue($user->isActive());
$this->assertFalse($user->isBanned());

// Null
$this->assertNull($user->deletedAt);
$this->assertNotNull($user->email);

// –ú–∞—Å—Å–∏–≤—ã
$this->assertCount(3, $items);
$this->assertContains('apple', $fruits);
$this->assertArrayHasKey('email', $data);

// –°—Ç—Ä–æ–∫–∏
$this->assertStringContainsString('error', $message);
$this->assertStringStartsWith('Hello', $greeting);

// –ò—Å–∫–ª—é—á–µ–Ω–∏—è
$this->expectException(InvalidArgumentException::class);
$user->setAge(-5); // –¥–æ–ª–∂–Ω–æ –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
```

### –ü—Ä–∏–º–µ—Ä: –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç –∫–ª–∞—Å—Å–∞

**src/Order.php:**
```php
<?php

namespace App;

class Order
{
    private array $items = [];
    private float $tax = 0.2; // 20% –Ω–∞–ª–æ–≥
    
    public function addItem(string $name, float $price): void
    {
        if ($price < 0) {
            throw new \InvalidArgumentException('Price cannot be negative');
        }
        
        $this->items[] = ['name' => $name, 'price' => $price];
    }
    
    public function getSubtotal(): float
    {
        return array_sum(array_column($this->items, 'price'));
    }
    
    public function getTotal(): float
    {
        return $this->getSubtotal() * (1 + $this->tax);
    }
    
    public function isEmpty(): bool
    {
        return empty($this->items);
    }
}
```

**tests/Unit/OrderTest.php:**
```php
<?php

namespace Tests\Unit;

use PHPUnit\Framework\TestCase;
use App\Order;

class OrderTest extends TestCase
{
    private Order $order;
    
    protected function setUp(): void
    {
        parent::setUp();
        $this->order = new Order();
    }
    
    public function test_new_order_is_empty()
    {
        $this->assertTrue($this->order->isEmpty());
        $this->assertEquals(0, $this->order->getSubtotal());
    }
    
    public function test_can_add_item()
    {
        $this->order->addItem('Laptop', 1000);
        
        $this->assertFalse($this->order->isEmpty());
        $this->assertEquals(1000, $this->order->getSubtotal());
    }
    
    public function test_calculates_total_with_tax()
    {
        $this->order->addItem('Laptop', 1000);
        
        // 1000 + 20% = 1200
        $this->assertEquals(1200, $this->order->getTotal());
    }
    
    public function test_multiple_items()
    {
        $this->order->addItem('Laptop', 1000);
        $this->order->addItem('Mouse', 50);
        
        $this->assertEquals(1050, $this->order->getSubtotal());
        $this->assertEquals(1260, $this->order->getTotal());
    }
    
    public function test_throws_exception_for_negative_price()
    {
        $this->expectException(\InvalidArgumentException::class);
        $this->expectExceptionMessage('Price cannot be negative');
        
        $this->order->addItem('Broken', -100);
    }
}
```

**–ó–∞–ø—É—Å–∫:**
```bash
vendor/bin/phpunit tests/Unit/OrderTest.php

.....                                                               5 / 5 (100%)

OK (5 tests, 10 assertions)
```

---

## üé® Data Providers ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

–í–º–µ—Å—Ç–æ –∫–æ–ø–∏–ø–∞—Å—Ç–∞ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```php
class CalculatorTest extends TestCase
{
    /**
     * @dataProvider additionProvider
     */
    public function test_addition(int $a, int $b, int $expected)
    {
        $calc = new Calculator();
        $this->assertEquals($expected, $calc->add($a, $b));
    }
    
    public static function additionProvider(): array
    {
        return [
            'positive numbers' => [2, 3, 5],
            'negative numbers' => [-2, -3, -5],
            'mixed' => [10, -5, 5],
            'with zero' => [0, 5, 5],
            'large numbers' => [1000, 2000, 3000],
        ];
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
.....                                                               5 / 5 (100%)

‚úì Addition with data set "positive numbers"
‚úì Addition with data set "negative numbers"
‚úì Addition with data set "mixed"
‚úì Addition with data set "with zero"
‚úì Addition with data set "large numbers"
```

---

## üö¶ –ü—Ä–∞–∫—Ç–∏–∫–∞: TDD-—Ü–∏–∫–ª (Red-Green-Refactor)

### –ó–∞–¥–∞—á–∞: –í–∞–ª–∏–¥–∞—Ç–æ—Ä email

**–®–∞–≥ 1: RED ‚Äî –ø–∏—à–µ–º –¢–ï–°–¢ (–æ–Ω —É–ø–∞–¥–µ—Ç)**

```php
class EmailValidatorTest extends TestCase
{
    public function test_valid_email_passes()
    {
        $validator = new EmailValidator();
        $this->assertTrue($validator->isValid('test@example.com'));
    }
}
```

–ó–∞–ø—É—Å–∫ ‚Üí ‚ùå **Error: Class EmailValidator not found**

**–®–∞–≥ 2: GREEN ‚Äî –ø–∏—à–µ–º –ö–û–î (–º–∏–Ω–∏–º—É–º –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è)**

```php
class EmailValidator
{
    public function isValid(string $email): bool
    {
        return true; // –ó–∞–≥–ª—É—à–∫–∞, —á—Ç–æ–±—ã —Ç–µ—Å—Ç –ø—Ä–æ—à–µ–ª
    }
}
```

–ó–∞–ø—É—Å–∫ ‚Üí ‚úÖ **OK (1 test)**

**–®–∞–≥ 3: –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –£–ü–ê–î–ï–¢**

```php
public function test_invalid_email_fails()
{
    $validator = new EmailValidator();
    $this->assertFalse($validator->isValid('not-an-email'));
}
```

–ó–∞–ø—É—Å–∫ ‚Üí ‚ùå **Failed: true is not false**

**–®–∞–≥ 4: –†–µ–∞–ª–∏–∑—É–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é**

```php
class EmailValidator
{
    public function isValid(string $email): bool
    {
        return filter_var($email, FILTER_VALIDATE_EMAIL) !== false;
    }
}
```

–ó–∞–ø—É—Å–∫ ‚Üí ‚úÖ **OK (2 tests)**

**–®–∞–≥ 5: REFACTOR ‚Äî —É–ª—É—á—à–∞–µ–º –±–µ–∑ –ª–æ–º–∫–∏ —Ç–µ—Å—Ç–æ–≤**

```php
class EmailValidator
{
    public function isValid(string $email): bool
    {
        // –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ–º–µ–Ω–∞
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            return false;
        }
        
        $domain = substr($email, strpos($email, '@') + 1);
        return checkdnsrr($domain, 'MX');
    }
}
```

–¢–µ—Å—Ç—ã –≤—Å–µ –µ—â–µ –ø—Ä–æ—Ö–æ–¥—è—Ç ‚Üí —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ.

---

## ‚ö° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã PHPUnit

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
vendor/bin/phpunit

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
vendor/bin/phpunit tests/Unit/OrderTest.php

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–µ—Ç–æ–¥
vendor/bin/phpunit --filter test_addition

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ Unit-—Ç–µ—Å—Ç—ã
vendor/bin/phpunit --testsuite Unit

# –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ (–Ω—É–∂–µ–Ω Xdebug)
vendor/bin/phpunit --coverage-html coverage

# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
vendor/bin/phpunit --verbose

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
vendor/bin/phpunit --stop-on-failure
```

---

## üõ†Ô∏è –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è

### –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 1: –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç
–°–æ–∑–¥–∞–π –∫–ª–∞—Å—Å `Temperature` —Å –º–µ—Ç–æ–¥–æ–º `toFahrenheit($celsius)`. –ù–∞–ø–∏—à–∏ —Ç–µ—Å—Ç—ã:
- 0¬∞C = 32¬∞F
- 100¬∞C = 212¬∞F
- -40¬∞C = -40¬∞F

<details>
<summary>–†–µ—à–µ–Ω–∏–µ</summary>

```php
// src/Temperature.php
class Temperature
{
    public function toFahrenheit(float $celsius): float
    {
        return ($celsius * 9/5) + 32;
    }
}

// tests/Unit/TemperatureTest.php
class TemperatureTest extends TestCase
{
    private Temperature $temp;
    
    protected function setUp(): void
    {
        $this->temp = new Temperature();
    }
    
    public function test_zero_celsius()
    {
        $this->assertEquals(32, $this->temp->toFahrenheit(0));
    }
    
    public function test_boiling_point()
    {
        $this->assertEquals(212, $this->temp->toFahrenheit(100));
    }
    
    public function test_negative_forty()
    {
        $this->assertEquals(-40, $this->temp->toFahrenheit(-40));
    }
}
```
</details>

### –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 2: Data Provider
–ö–ª–∞—Å—Å `PasswordStrength` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è. –ò—Å–ø–æ–ª—å–∑—É–π Data Provider –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- –°–ª–∞–±—ã–µ: "123", "password", "abc"
- –°–∏–ª—å–Ω—ã–µ: "P@ssw0rd!", "MySecure123#"

<details>
<summary>–†–µ—à–µ–Ω–∏–µ</summary>

```php
class PasswordStrength
{
    public function isStrong(string $password): bool
    {
        if (strlen($password) < 8) return false;
        if (!preg_match('/[A-Z]/', $password)) return false;
        if (!preg_match('/[a-z]/', $password)) return false;
        if (!preg_match('/[0-9]/', $password)) return false;
        if (!preg_match('/[\W]/', $password)) return false;
        
        return true;
    }
}

class PasswordStrengthTest extends TestCase
{
    /**
     * @dataProvider weakPasswordsProvider
     */
    public function test_weak_passwords($password)
    {
        $checker = new PasswordStrength();
        $this->assertFalse($checker->isStrong($password));
    }
    
    /**
     * @dataProvider strongPasswordsProvider
     */
    public function test_strong_passwords($password)
    {
        $checker = new PasswordStrength();
        $this->assertTrue($checker->isStrong($password));
    }
    
    public static function weakPasswordsProvider(): array
    {
        return [
            ['123'],
            ['password'],
            ['abc'],
            ['NoNumbers!'],
            ['nocapitals123!']
        ];
    }
    
    public static function strongPasswordsProvider(): array
    {
        return [
            ['P@ssw0rd!'],
            ['MySecure123#'],
            ['Qwerty123$']
        ];
    }
}
```
</details>

### –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 3: TDD ‚Äî –∫–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫
–ú–µ—Ç–æ–¥–æ–º TDD —Å–æ–∑–¥–∞–π –∫–ª–∞—Å—Å `Cart`:
1. –ù–∞—á–Ω–∏ —Å —Ç–µ—Å—Ç–∞ `test_new_cart_is_empty`
2. –î–æ–±–∞–≤—å `addProduct($name, $price, $quantity)`
3. –†–µ–∞–ª–∏–∑—É–π `getTotal()`
4. –î–æ–±–∞–≤—å —Å–∫–∏–¥–∫—É 10% –ø—Ä–∏ —Å—É–º–º–µ > 1000

<details>
<summary>–†–µ—à–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–∏—à–∏ —Å–∞–º!)</summary>

```php
class CartTest extends TestCase
{
    private Cart $cart;
    
    protected function setUp(): void
    {
        $this->cart = new Cart();
    }
    
    public function test_new_cart_is_empty()
    {
        $this->assertEquals(0, $this->cart->getTotal());
    }
    
    public function test_add_single_product()
    {
        $this->cart->addProduct('Laptop', 1000, 1);
        $this->assertEquals(1000, $this->cart->getTotal());
    }
    
    public function test_add_multiple_quantity()
    {
        $this->cart->addProduct('Mouse', 50, 3);
        $this->assertEquals(150, $this->cart->getTotal());
    }
    
    public function test_discount_applies_over_1000()
    {
        $this->cart->addProduct('Laptop', 1200, 1);
        // 1200 - 10% = 1080
        $this->assertEquals(1080, $this->cart->getTotal());
    }
    
    public function test_no_discount_under_1000()
    {
        $this->cart->addProduct('Mouse', 500, 1);
        $this->assertEquals(500, $this->cart->getTotal());
    }
}
```
</details>

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç: –ß—Ç–æ —Ç—ã —Ç–µ–ø–µ—Ä—å –∑–Ω–∞–µ—à—å

- [ ] –ü–æ–Ω–∏–º–∞—é –∑–∞—á–µ–º –Ω—É–∂–Ω—ã —Ç–µ—Å—Ç—ã (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Ä–µ–≥—Ä–µ—Å—Å)
- [ ] –ó–Ω–∞—é –ø–∏—Ä–∞–º–∏–¥—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Unit ‚Üí Integration ‚Üí E2E)
- [ ] –£–º–µ—é —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å PHPUnit
- [ ] –ú–æ–≥—É –Ω–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç —Å `assertEquals`, `assertTrue`
- [ ] –ü–æ–Ω–∏–º–∞—é `setUp()` –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é Data Providers –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ó–Ω–∞—é —Ü–∏–∫–ª TDD: Red ‚Üí Green ‚Üí Refactor
- [ ] –£–º–µ—é –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏

---

## üéì –ò—Ç–æ–≥–∏

–¢–µ—Å—Ç—ã ‚Äî –Ω–µ "–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞", –∞ **–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ –±—É–¥—É—â–µ–µ**. –ü–µ—Ä–≤—ã–µ 2 –Ω–µ–¥–µ–ª–∏ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –ø–∏—à–µ—à—å –≤ 2 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ. –ß–µ—Ä–µ–∑ –º–µ—Å—è—Ü –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ —ç–∫–æ–Ω–æ–º–∏—à—å —á–∞—Å—ã –Ω–∞ –¥–µ–±–∞–≥–µ.

**–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞:** Unit-—Ç–µ—Å—Ç—ã –≥–ª—É–±–∂–µ ‚Äî –º–æ–∫–∏, —Å—Ç–∞–±—ã, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

1. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `assertEquals` –∏ `assertSame`?
2. –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Unit-—Ç–µ—Å—Ç—ã, –∞ –∫–æ–≥–¥–∞ Integration?
3. –ß—Ç–æ —Ç–∞–∫–æ–µ Data Provider –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?
4. –û–±—ä—è—Å–Ω–∏ —Ü–∏–∫–ª TDD —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏
5. –ü–æ—á–µ–º—É —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–¥–Ω—É –≤–µ—â—å?

–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤—Å–µ ‚Äî –≥–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–π –≥–ª–∞–≤–µ! üöÄ