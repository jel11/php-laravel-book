# –ì–ª–∞–≤–∞ 6.3: –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–∞—Ä–æ–ª–∏ ‚Äî password_hash, password_verify, –ø–æ—á–µ–º—É MD5 ‚Äî —ç—Ç–æ –ø–ª–æ—Ö–æ

## üìñ –í–≤–µ–¥–µ–Ω–∏–µ

–ü—Ä–µ–¥—Å—Ç–∞–≤—å: —Ç—ã —Å–æ–∑–¥–∞—ë—à—å —Å–∞–π—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —Å –ø–∞—Ä–æ–ª–µ–º `qwerty123`. –¢—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—à—å —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –µ—Å—Ç—å. –ó–∞–≤—Ç—Ä–∞ —Ö–∞–∫–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–≤–æ–µ–π –ë–î —á–µ—Ä–µ–∑ SQL-–∏–Ω—ä–µ–∫—Ü–∏—é –∏–ª–∏ —É—Ç–µ—á–∫—É –¥–∞–Ω–Ω—ã—Ö. –ß—Ç–æ –æ–Ω –≤–∏–¥–∏—Ç? –ü–∞—Ä–æ–ª–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.

**–í—ã–≤–æ–¥:** –Ω–∏–∫–æ–≥–¥–∞, –Ω–∏–∫–æ–≥–¥–∞, –ù–ò–ö–û–ì–î–ê –Ω–µ —Ö—Ä–∞–Ω–∏ –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.

### –ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ?

1. **–õ—é–¥–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –≤–µ–∑–¥–µ** ‚Äî –≤–∑–ª–æ–º–∞–≤ —Ç–≤–æ–π —Å–∞–π—Ç, —Ö–∞–∫–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–æ—á—Ç–µ, —Å–æ—Ü—Å–µ—Ç—è–º, –±–∞–Ω–∫–æ–≤—Å–∫–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–£—Ç–µ—á–∫–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö —Å–ª—É—á–∞—é—Ç—Å—è –¥–∞–∂–µ —É –≥–∏–≥–∞–Ω—Ç–æ–≤** ‚Äî Yahoo, LinkedIn, Adobe ‚Äî –≤—Å–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–ª–∏
3. **–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å** ‚Äî –≤ –ï–° –∑–∞ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —à—Ç—Ä–∞—Ñ –¥–æ 4% –≥–æ–¥–æ–≤–æ–≥–æ –æ–±–æ—Ä–æ—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏ (GDPR)

–í —ç—Ç–æ–π –≥–ª–∞–≤–µ —Ç—ã –Ω–∞—É—á–∏—à—å—Å—è **–ø—Ä–∞–≤–∏–ª—å–Ω–æ** —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–∞—Ä–æ–ª—è–º–∏ –≤ PHP.

---

## üîê –¢–µ–æ—Ä–∏—è: –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ vs –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ?

**–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —ç—Ç–æ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã (—Ö–µ—à).

```
–ü–∞—Ä–æ–ª—å: "qwerty123"
–•–µ—à:    "$2y$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy"
```

**–ö–ª—é—á–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞:**
- ‚úÖ **–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–æ—Å—Ç—å** ‚Äî –∏–∑ —Ö–µ—à–∞ –Ω–µ–ª—å–∑—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –ø–∞—Ä–æ–ª—å
- ‚úÖ **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** ‚Äî –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–∞—Ä–æ–ª—å –≤—Å–µ–≥–¥–∞ –¥–∞—ë—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ö–µ—à
- ‚úÖ **–õ–∞–≤–∏–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç** ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–µ–Ω—è–µ—Ç —Ö–µ—à

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ vs –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ |
|---------------|-------------|------------|
| **–û–±—Ä–∞—Ç–∏–º–æ—Å—Ç—å** | –ù–µ—Ç (–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è) | –î–∞ (—Å –∫–ª—é—á–æ–º) |
| **–†–µ–∑—É–ª—å—Ç–∞—Ç** | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–ª–∏–Ω–∞ | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª–∏–Ω–∞ |
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π | –ó–∞—â–∏—Ç–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| **–ü—Ä–∏–º–µ—Ä** | `password_hash()` | `openssl_encrypt()` |

**–ü—Ä–∏–º–µ—Ä —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –ø–∞—Ä–æ–ª–µ–π!):**
```php
// ‚ùå –ü–õ–û–•–û: —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–∏–º–æ
$encrypted = openssl_encrypt($password, 'AES-128-CBC', $key);
$decrypted = openssl_decrypt($encrypted, 'AES-128-CBC', $key);
// $decrypted === $password ‚Äî –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å!
```

**–ü—Ä–∏–º–µ—Ä —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!):**
```php
// ‚úÖ –•–û–†–û–®–û: —Ö–µ—à –Ω–µ–æ–±—Ä–∞—Ç–∏–º
$hash = password_hash($password, PASSWORD_BCRYPT);
// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å $password –∏–∑ $hash –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!
```

---

## ‚ùå –ü–æ—á–µ–º—É MD5, SHA1 –∏ SHA256 ‚Äî —ç—Ç–æ –ø–ª–æ—Ö–æ

### –ü—Ä–æ–±–ª–µ–º–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏

MD5 –∏ SHA-—Å–µ–º–µ–π—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è **–±—ã—Å—Ç—Ä–æ–≥–æ** –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ö–µ—à–µ–π. –≠—Ç–æ —Ö–æ—Ä–æ—à–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤, –Ω–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞ –¥–ª—è –ø–∞—Ä–æ–ª–µ–π.

```php
// MD5 ‚Äî —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–π
$start = microtime(true);
for ($i = 0; $i < 1000000; $i++) {
    md5('password');
}
echo microtime(true) - $start; // ~0.5 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –º–∏–ª–ª–∏–æ–Ω —Ö–µ—à–µ–π!
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ?**

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞ NVIDIA RTX 4090 –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- **MD5:** ~200 –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤ —Ö–µ—à–µ–π –≤ —Å–µ–∫—É–Ω–¥—É
- **SHA256:** ~100 –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤ —Ö–µ—à–µ–π –≤ —Å–µ–∫—É–Ω–¥—É
- **bcrypt:** ~100 —Ç—ã—Å—è—á —Ö–µ—à–µ–π –≤ —Å–µ–∫—É–Ω–¥—É

### Rainbow Tables (—Ä–∞–¥—É–∂–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã)

–≠—Ç–æ –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–∞:

```
–ø–∞—Ä–æ–ª—å      ‚Üí MD5 —Ö–µ—à
password    ‚Üí 5f4dcc3b5aa765d61d8327deb882cf99
123456      ‚Üí e10adc3949ba59abbe56e057f20f883e
qwerty      ‚Üí d8578edf8458ce06fbc5bb76a58c5ca4
```

**–ê—Ç–∞–∫–∞:**
1. –•–∞–∫–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Ö–µ—à –∏–∑ –ë–î: `5f4dcc3b5aa765d61d8327deb882cf99`
2. –ò—â–µ—Ç –µ–≥–æ –≤ rainbow table
3. –ù–∞—Ö–æ–¥–∏—Ç: —ç—Ç–æ –ø–∞—Ä–æ–ª—å `password`
4. –ü—Ä–æ—Ñ–∏—Ç!

### –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ–ª–∏

```php
// ‚ùå –ü–õ–û–•–û: –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–∞—Ä–æ–ª—è –¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ö–µ—à–∏
echo md5('qwerty'); // d8578edf8458ce06fbc5bb76a58c5ca4
echo md5('qwerty'); // d8578edf8458ce06fbc5bb76a58c5ca4
```

–ï—Å–ª–∏ —É —Ç—ã—Å—è—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–∞—Ä–æ–ª—å `123456`, —Ö–∞–∫–µ—Ä —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç —ç—Ç–æ –ø–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Ö–µ—à–∞–º.

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±: password_hash() –∏ password_verify()

PHP –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

### password_hash() ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ö–µ—à–∞

```php
$password = 'qwerty123';
$hash = password_hash($password, PASSWORD_BCRYPT);

echo $hash;
// $2y$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `password_hash()`:**

1. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç **—Å–æ–ª—å** (salt) ‚Äî —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–µ–¥–ª–µ–Ω–Ω—ã–π** –∞–ª–≥–æ—Ä–∏—Ç–º (bcrypt –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
3. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–ª—å –∏ cost –≤ —Å–∞–º–æ–º —Ö–µ—à–µ
4. ‚úÖ –ö–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞—ë—Ç **—Ä–∞–∑–Ω—ã–µ** —Ö–µ—à–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è

```php
// –î–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–∞—Ä–æ–ª—è ‚Äî —Ä–∞–∑–Ω—ã–µ —Ö–µ—à–∏ (–∏–∑-–∑–∞ —Ä–∞–∑–Ω–æ–π —Å–æ–ª–∏)
echo password_hash('qwerty', PASSWORD_BCRYPT) . "\n";
// $2y$10$abcdefghijklmnopqrstuv1234567890ABCDEFGHIJKLMNOPQRS

echo password_hash('qwerty', PASSWORD_BCRYPT) . "\n";
// $2y$10$XYZXYZXYZXYZXYZXYZXYZXYZ9876543210zyxwvutsrqponmlkji
```

### password_verify() ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è

```php
$password = 'qwerty123';
$hash = '$2y$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy';

if (password_verify($password, $hash)) {
    echo "–ü–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π!";
} else {
    echo "–ü–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π!";
}
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `password_verify()`:**

1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–æ–ª—å –∏ cost –∏–∑ —Ö–µ—à–∞
2. –•–µ—à–∏—Ä—É–µ—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å —Å —Ç–æ–π –∂–µ —Å–æ–ª—å—é
3. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º —Ö–µ—à–µ–º

---

## üèóÔ∏è –ü—Ä–∞–∫—Ç–∏–∫–∞: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã

```sql
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**–í–∞–∂–Ω–æ:** –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `password_hash`, –∞ –Ω–µ `password` ‚Äî —ç—Ç–æ —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ç–∞–º —Ö–µ—à!

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```php
<?php
// register.php

require 'db.php'; // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —á–µ—Ä–µ–∑ PDO

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = trim($_POST['email']);
    $password = $_POST['password'];
    $passwordConfirm = $_POST['password_confirm'];
    
    $errors = [];
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (empty($email) || !filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $errors[] = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email';
    }
    
    if (strlen($password) < 8) {
        $errors[] = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤';
    }
    
    if ($password !== $passwordConfirm) {
        $errors[] = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    $stmt = $pdo->prepare('SELECT id FROM users WHERE email = ?');
    $stmt->execute([$email]);
    if ($stmt->fetch()) {
        $errors[] = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
    }
    
    if (empty($errors)) {
        // ‚úÖ –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å
        $passwordHash = password_hash($password, PASSWORD_BCRYPT);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
        $stmt = $pdo->prepare('INSERT INTO users (email, password_hash) VALUES (?, ?)');
        $stmt->execute([$email, $passwordHash]);
        
        echo "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!";
        exit;
    }
    
    foreach ($errors as $error) {
        echo "<p style='color: red;'>$error</p>";
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
</head>
<body>
    <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
    <form method="POST">
        <p>
            <label>Email: <input type="email" name="email" required></label>
        </p>
        <p>
            <label>–ü–∞—Ä–æ–ª—å: <input type="password" name="password" required></label>
        </p>
        <p>
            <label>–ü–æ–≤—Ç–æ—Ä –ø–∞—Ä–æ–ª—è: <input type="password" name="password_confirm" required></label>
        </p>
        <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </form>
</body>
</html>
```

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```php
<?php
// login.php

session_start();
require 'db.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = trim($_POST['email']);
    $password = $_POST['password'];
    
    // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
    $stmt = $pdo->prepare('SELECT id, email, password_hash FROM users WHERE email = ?');
    $stmt->execute([$email]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);
    
    // ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
    if ($user && password_verify($password, $user['password_hash'])) {
        // –ü–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π ‚Äî —Å–æ–∑–¥–∞—ë–º —Å–µ—Å—Å–∏—é
        $_SESSION['user_id'] = $user['id'];
        $_SESSION['user_email'] = $user['email'];
        
        header('Location: dashboard.php');
        exit;
    } else {
        $error = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–í—Ö–æ–¥</title>
</head>
<body>
    <h1>–í—Ö–æ–¥</h1>
    
    <?php if (isset($error)): ?>
        <p style="color: red;"><?= htmlspecialchars($error) ?></p>
    <?php endif; ?>
    
    <form method="POST">
        <p>
            <label>Email: <input type="email" name="email" required></label>
        </p>
        <p>
            <label>–ü–∞—Ä–æ–ª—å: <input type="password" name="password" required></label>
        </p>
        <button type="submit">–í–æ–π—Ç–∏</button>
    </form>
    
    <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="register.php">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a></p>
</body>
</html>
```

---

## üîß –ê–ª–≥–æ—Ä–∏—Ç–º—ã —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### PASSWORD_BCRYPT (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```php
$hash = password_hash($password, PASSWORD_BCRYPT, ['cost' => 12]);
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **cost** (—Å–ª–æ–∂–Ω–æ—Å—Ç—å) ‚Äî –æ—Ç 4 –¥–æ 31, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10
- –ß–µ–º –≤—ã—à–µ cost, —Ç–µ–º –º–µ–¥–ª–µ–Ω–Ω–µ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (—É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è —Å –∫–∞–∂–¥—ã–º +1)

**–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å cost:**

```php
// –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
function testCost($cost) {
    $start = microtime(true);
    password_hash('test_password', PASSWORD_BCRYPT, ['cost' => $cost]);
    return microtime(true) - $start;
}

for ($cost = 8; $cost <= 14; $cost++) {
    $time = testCost($cost);
    echo "Cost $cost: " . round($time * 1000, 2) . " –º—Å\n";
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç (–ø—Ä–∏–º–µ—Ä–Ω–æ):
// Cost 8:  10 –º—Å
// Cost 9:  20 –º—Å
// Cost 10: 40 –º—Å    ‚Üê –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
// Cost 11: 80 –º—Å
// Cost 12: 160 –º—Å   ‚Üê —Ö–æ—Ä–æ—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è 2025 –≥–æ–¥–∞
// Cost 13: 320 –º—Å
// Cost 14: 640 –º—Å
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –≤—ã–±–µ—Ä–∏ cost —Ç–∞–∫, —á—Ç–æ–±—ã —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–Ω–∏–º–∞–ª–æ **~100-300 –º—Å**. –≠—Ç–æ –∑–∞—â–∏—Ç–∏—Ç –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞, –Ω–æ –Ω–µ –∑–∞–º–µ–¥–ª–∏—Ç —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞.

### PASSWORD_ARGON2I –∏ PASSWORD_ARGON2ID (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ)

```php
// Argon2i (–∑–∞—â–∏—Ç–∞ –æ—Ç side-channel –∞—Ç–∞–∫)
$hash = password_hash($password, PASSWORD_ARGON2I, [
    'memory_cost' => 65536,  // 64 MB
    'time_cost' => 4,        // 4 –∏—Ç–µ—Ä–∞—Ü–∏–∏
    'threads' => 2           // 2 –ø–æ—Ç–æ–∫–∞
]);

// Argon2id (–≥–∏–±—Ä–∏–¥, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
$hash = password_hash($password, PASSWORD_ARGON2ID, [
    'memory_cost' => 65536,
    'time_cost' => 4,
    'threads' => 2
]);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Argon2:**
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫ —á–µ—Ä–µ–∑ GPU (—Ç—Ä–µ–±—É–µ—Ç –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è CPU, RAM –∏ –ø–æ—Ç–æ–∫–æ–≤
- ‚úÖ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å Password Hashing Competition 2015

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –¢—Ä–µ–±—É–µ—Ç PHP 7.2+ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Sodium
- ‚ùå –ú–µ–Ω—å—à–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω, —á–µ–º bcrypt

### PASSWORD_DEFAULT (–∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ!)

```php
$hash = password_hash($password, PASSWORD_DEFAULT);
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–∏–π –≤—ã–±–æ—Ä:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∞–º—ã–π –Ω–∞–¥—ë–∂–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (—Å–µ–π—á–∞—Å bcrypt)
- ‚úÖ –í –±—É–¥—É—â–µ–º –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –±–æ–ª–µ–µ –Ω–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
- ‚úÖ –ö–æ–¥ –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ PHP

---

## üîÑ –†–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞

–ö–æ–≥–¥–∞ —Ç—ã –º–µ–Ω—è–µ—à—å –∞–ª–≥–æ—Ä–∏—Ç–º –∏–ª–∏ cost, —Å—Ç–∞—Ä—ã–µ —Ö–µ—à–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î. –†–µ—à–µ–Ω–∏–µ: **—Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ**.

```php
<?php
// login.php

session_start();
require 'db.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = trim($_POST['email']);
    $password = $_POST['password'];
    
    $stmt = $pdo->prepare('SELECT id, email, password_hash FROM users WHERE email = ?');
    $stmt->execute([$email]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if ($user && password_verify($password, $user['password_hash'])) {
        // ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ö–µ—à
        if (password_needs_rehash($user['password_hash'], PASSWORD_DEFAULT)) {
            $newHash = password_hash($password, PASSWORD_DEFAULT);
            
            $stmt = $pdo->prepare('UPDATE users SET password_hash = ? WHERE id = ?');
            $stmt->execute([$newHash, $user['id']]);
            
            error_log("–û–±–Ω–æ–≤–ª—ë–Ω —Ö–µ—à –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {$user['id']}");
        }
        
        $_SESSION['user_id'] = $user['id'];
        header('Location: dashboard.php');
        exit;
    }
    
    $error = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
}
?>
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `password_needs_rehash()`:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–∑–¥–∞–Ω –ª–∏ —Ö–µ—à —Å —Ç–µ–∫—É—â–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ —Ö–µ—à —É—Å—Ç–∞—Ä–µ–ª

---

## üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. Rate Limiting (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫)

```php
<?php
// login.php —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞

session_start();
require 'db.php';

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
$ip = $_SERVER['REMOTE_ADDR'];
$stmt = $pdo->prepare('
    SELECT COUNT(*) as attempts 
    FROM login_attempts 
    WHERE ip = ? AND attempted_at > NOW() - INTERVAL 15 MINUTE
');
$stmt->execute([$ip]);
$attempts = $stmt->fetchColumn();

if ($attempts >= 5) {
    die('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç.');
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = trim($_POST['email']);
    $password = $_POST['password'];
    
    $stmt = $pdo->prepare('SELECT id, email, password_hash FROM users WHERE email = ?');
    $stmt->execute([$email]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if ($user && password_verify($password, $user['password_hash'])) {
        // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ ‚Äî –æ—á–∏—â–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏
        $pdo->prepare('DELETE FROM login_attempts WHERE ip = ?')->execute([$ip]);
        
        $_SESSION['user_id'] = $user['id'];
        header('Location: dashboard.php');
        exit;
    } else {
        // –ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞–µ–º
        $stmt = $pdo->prepare('INSERT INTO login_attempts (ip, attempted_at) VALUES (?, NOW())');
        $stmt->execute([$ip]);
        
        $error = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
    }
}
?>
```

**–¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –ø–æ–ø—ã—Ç–æ–∫:**

```sql
CREATE TABLE login_attempts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    ip VARCHAR(45) NOT NULL,
    attempted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX (ip, attempted_at)
);
```

### 2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—è–º

```php
function validatePassword($password) {
    $errors = [];
    
    if (strlen($password) < 12) {
        $errors[] = '–ú–∏–Ω–∏–º—É–º 12 —Å–∏–º–≤–æ–ª–æ–≤';
    }
    
    if (!preg_match('/[a-z]/', $password)) {
        $errors[] = '–ù—É–∂–Ω–∞ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞';
    }
    
    if (!preg_match('/[A-Z]/', $password)) {
        $errors[] = '–ù—É–∂–Ω–∞ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞';
    }
    
    if (!preg_match('/[0-9]/', $password)) {
        $errors[] = '–ù—É–∂–Ω–∞ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞';
    }
    
    if (!preg_match('/[^a-zA-Z0-9]/', $password)) {
        $errors[] = '–ù—É–∂–µ–Ω –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª (!@#$%^&*)';
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
    $commonPasswords = ['Password123!', 'Qwerty123!', 'Admin123!'];
    if (in_array($password, $commonPasswords)) {
        $errors[] = '–≠—Ç–æ—Ç –ø–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–π';
    }
    
    return $errors;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
$errors = validatePassword($_POST['password']);
if (!empty($errors)) {
    foreach ($errors as $error) {
        echo "<p>$error</p>";
    }
}
```

### 3. –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)

```php
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–∞ –¥–ª—è Google Authenticator
// composer require pragmarx/google2fa

use PragmaRX\Google2FA\Google2FA;

$google2fa = new Google2FA();

// –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ 2FA
$secret = $google2fa->generateSecretKey();

// –°–æ—Ö—Ä–∞–Ω—è–µ–º $secret –≤ –ë–î –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
$stmt = $pdo->prepare('UPDATE users SET totp_secret = ? WHERE id = ?');
$stmt->execute([$secret, $userId]);

// QR-–∫–æ–¥ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
$qrCodeUrl = $google2fa->getQRCodeUrl(
    'MyApp',
    $userEmail,
    $secret
);

// –ü—Ä–∏ –≤—Ö–æ–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
$valid = $google2fa->verifyKey($user['totp_secret'], $_POST['totp_code']);
```

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### ‚ùå –û—à–∏–±–∫–∞ 1: –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

```php
// ‚ùå –ü–õ–û–•–û: –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π —Ö–µ—à
$hash1 = password_hash($password, PASSWORD_BCRYPT);
$hash2 = password_hash($password, PASSWORD_BCRYPT);
// $hash1 !== $hash2 ‚Äî –∫–∞–∫ —Ç–æ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å?!
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**

```php
// ‚úÖ –•–û–†–û–®–û: —Ö–µ—à–∏—Ä—É–µ–º –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
$hash = password_hash($password, PASSWORD_BCRYPT);
// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î

// –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º password_verify()
password_verify($inputPassword, $hash); // –†–∞–±–æ—Ç–∞–µ—Ç!
```

### ‚ùå –û—à–∏–±–∫–∞ 2: –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è –¥–≤–∞–∂–¥—ã

```php
// ‚ùå –ü–õ–û–•–û: —Ö–µ—à –æ—Ç —Ö–µ—à–∞
$hash = password_hash($password, PASSWORD_BCRYPT);
$doubleHash = password_hash($hash, PASSWORD_BCRYPT);

// –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ
password_verify($password, $doubleHash); // FALSE ‚Äî –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç!
```

### ‚ùå –û—à–∏–±–∫–∞ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

```php
// ‚ùå –ü–õ–û–•–û: —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
crypt($password, $salt);     // –ò—Å–ø–æ–ª—å–∑—É–π password_hash()
md5($password);              // –ö–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –Ω–µ—Ç!
sha1($password);             // –¢–æ–∂–µ –Ω–µ—Ç!
hash('sha256', $password);   // –°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ!
```

### ‚ùå –û—à–∏–±–∫–∞ 4: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```php
// ‚ùå –ü–õ–û–•–û: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö–µ—à–µ–π
$inputHash = password_hash($inputPassword, PASSWORD_BCRYPT);
if ($inputHash === $savedHash) { // –í—Å–µ–≥–¥–∞ FALSE –∏–∑-–∑–∞ —Ä–∞–∑–Ω–æ–π —Å–æ–ª–∏!
    echo "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω";
}

// ‚úÖ –•–û–†–û–®–û: –∏—Å–ø–æ–ª—å–∑—É–π password_verify()
if (password_verify($inputPassword, $savedHash)) {
    echo "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω";
}
```

---

## üß™ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: –ë–∞–∑–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏:
- Email –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
- –ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
- –ü–∞—Ä–æ–ª–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å
- –•–µ—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î

### –ó–∞–¥–∞–Ω–∏–µ 2: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º

–†–µ–∞–ª–∏–∑—É–π:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ email/–ø–∞—Ä–æ–ª—å
- Checkbox "–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è" (cookie –Ω–∞ 30 –¥–Ω–µ–π)
- –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ (—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏)

**–ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è "–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è":**

```php
if (isset($_POST['remember_me'])) {
    $token = bin2hex(random_bytes(32));
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ –ë–î
    $stmt = $pdo->prepare('UPDATE users SET remember_token = ? WHERE id = ?');
    $stmt->execute([password_hash($token, PASSWORD_BCRYPT), $userId]);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ cookie
    setcookie('remember_token', $token, time() + 30 * 24 * 3600, '/', '', true, true);
}
```

### –ó–∞–¥–∞–Ω–∏–µ 3: –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

–†–µ–∞–ª–∏–∑—É–π —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –ø–∞—Ä–æ–ª—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
- –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–µ—à–∞ –≤ –ë–î

### –ó–∞–¥–∞–Ω–∏–µ 4: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è

–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ (–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–µ—Å—Ç–∏ –Ω–∞ —ç–∫—Ä–∞–Ω)
4. –ü–æ —Å—Å—ã–ª–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
5. –¢–æ–∫–µ–Ω –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∏ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 1 —á–∞—Å

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:**

```sql
CREATE TABLE password_resets (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) NOT NULL,
    token VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX (email, token)
);
```

### –ó–∞–¥–∞–Ω–∏–µ 5: –ú–∏–≥—Ä–∞—Ü–∏—è —Å MD5 –Ω–∞ bcrypt

–£ —Ç–µ–±—è –µ—Å—Ç—å —Å—Ç–∞—Ä–∞—è –ë–î —Å –ø–∞—Ä–æ–ª—è–º–∏ –≤ MD5. –ù–∞–ø–∏—à–∏ —Å–∫—Ä–∏–ø—Ç:
- –ü—Ä–∏ –≤—Ö–æ–¥–µ –ø—Ä–æ–≤–µ—Ä—è–π, –µ—Å—Ç—å –ª–∏ –ø–æ–ª–µ `legacy_md5`
- –ï—Å–ª–∏ –¥–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ `md5($password) === $user['legacy_md5']`
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ —Å–æ–∑–¥–∞–π `password_hash()` –∏ —É–¥–∞–ª–∏ `legacy_md5`

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

| –ê–ª–≥–æ—Ä–∏—Ç–º | –°–∫–æ—Ä–æ—Å—Ç—å | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|----------|--------------|--------------|
| **MD5** | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π | ‚ùå –í–∑–ª–æ–º–∞–Ω | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π |
| **SHA1** | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π | ‚ùå –í–∑–ª–æ–º–∞–Ω | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π |
| **SHA256** | –ë—ã—Å—Ç—Ä—ã–π | ‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–π | –ù–µ –¥–ª—è –ø–∞—Ä–æ–ª–µ–π |
| **bcrypt** | –ú–µ–¥–ª–µ–Ω–Ω—ã–π ‚úÖ | ‚úÖ –ù–∞–¥—ë–∂–Ω—ã–π | **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** |
| **Argon2** | –ú–µ–¥–ª–µ–Ω–Ω—ã–π ‚úÖ | ‚úÖ –û—á–µ–Ω—å –Ω–∞–¥—ë–∂–Ω—ã–π | –û—Ç–ª–∏—á–Ω–æ, –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |

---

## üéì –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. **–ß–µ–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è?**
2. **–ü–æ—á–µ–º—É MD5 –∏ SHA256 –ø–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ø–∞—Ä–æ–ª–µ–π?**
3. **–ß—Ç–æ —Ç–∞–∫–æ–µ "—Å–æ–ª—å" (salt) –∏ –∑–∞—á–µ–º –æ–Ω–∞ –Ω—É–∂–Ω–∞?**
4. **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `password_verify()` –≤–Ω—É—Ç—Ä–∏?**
5. **–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?**
6. **–ó–∞—á–µ–º –Ω—É–∂–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `cost` –≤ bcrypt?**
7. **–ú–æ–∂–Ω–æ –ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –∏–∑ —Ö–µ—à–∞?**
8. **–ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏?**

---

## üìö –†–µ–∑—é–º–µ –≥–ª–∞–≤—ã

‚úÖ **–ß—Ç–æ —Ç—ã —É–∑–Ω–∞–ª:**

1. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚â† –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Ö–µ—à –Ω–µ–æ–±—Ä–∞—Ç–∏–º, —ç—Ç–æ –∑–∞—â–∏—Ç–∞
2. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π MD5/SHA –¥–ª—è –ø–∞—Ä–æ–ª–µ–π** ‚Äî —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–µ, –µ—Å—Ç—å rainbow tables
3. **`password_hash()`** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ PHP
4. **`password_verify()`** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è
5. **–°–æ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** ‚Äî –Ω–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
6. **–†–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π `password_needs_rehash()`
7. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞** ‚Äî rate limiting, 2FA, —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏

üîê **–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:**

```php
// –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
$hash = password_hash($password, PASSWORD_DEFAULT);

// –ü—Ä–∏ –≤—Ö–æ–¥–µ
if (password_verify($inputPassword, $savedHash)) {
    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
}
```

–í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –¥–µ—Ç–∞–ª–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è. –ù–æ —ç—Ç–∏ –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –æ—Å–Ω–æ–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π.

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

–í —Å–ª–µ–¥—É—é—â–µ–π –≥–ª–∞–≤–µ **"–ì–ª–∞–≤–∞ 6.4: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ"** —Ç—ã —É–∑–Ω–∞–µ—à—å:
- –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é!)
- –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –¥–æ–≤–µ—Ä—è—Ç—å `$_FILES['file']['type']`
- –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª—ã –≤–Ω–µ webroot
- –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ PHP-—Å–∫—Ä–∏–ø—Ç–æ–≤
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –Ω–µ –æ–¥–Ω–∞ —Ñ–∏—á–∞, –∞ –æ–±—Ä–∞–∑ –º—ã—à–ª–µ–Ω–∏—è. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º! üí™