# ะะปะฐะฒะฐ 2.1: HTTP ะธ ะฒะตะฑ-ะพัะฝะพะฒั

## ะะฐะฟัะพัั ะธ ะพัะฒะตัั, GET/POST, ะทะฐะณะพะปะพะฒะบะธ, cookies, ัะตััะธะธ

---

## ะะพัะตะผั ะฒะฐะถะฝะพ ะฟะพะฝะธะผะฐัั HTTP?

**HTTP (HyperText Transfer Protocol)** โ ััะพ ัะทัะบ ะพะฑัะตะฝะธั ะผะตะถะดั ะฑัะฐัะทะตัะพะผ ะธ ัะตัะฒะตัะพะผ. ะะพะฝะธะผะฐะฝะธะต HTTP ะบัะธัะธัะตัะบะธ ะฒะฐะถะฝะพ ะดะปั ะฒะตะฑ-ัะฐะทัะฐะฑะพััะธะบะฐ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะะงะะะฃ HTTP ะะะะะ                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ   ๐ ะัะปะฐะดะบะฐ         ะะพะฝััั ะฟะพัะตะผั ะทะฐะฟัะพั ะฝะต ัะฐะฑะพัะฐะตั          โ
โ   ๐ ะะตะทะพะฟะฐัะฝะพััั    ะะฐัะธัะฐ ะพั CSRF, XSS, session hijacking    โ
โ   ๐ ะะฟัะธะผะธะทะฐัะธั     ะะตัะธัะพะฒะฐะฝะธะต, ัะถะฐัะธะต, keep-alive           โ
โ   ๐ API             REST API ะฟะพัััะพะตะฝ ะฝะฐ HTTP ะผะตัะพะดะฐั          โ
โ   ๐ช ะกะพััะพัะฝะธะต       Cookies ะธ ัะตััะธะธ ะดะปั ะฐะฒัะพัะธะทะฐัะธะธ          โ
โ   ๐ฑ ะะฝัะตะณัะฐัะธะธ      ะะฐะฑะพัะฐ ั ะฒะฝะตัะฝะธะผะธ ัะตัะฒะธัะฐะผะธ               โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 1. ะะฐะบ ัะฐะฑะพัะฐะตั HTTP

### ะะปะธะตะฝั-ัะตัะฒะตัะฝะฐั ะผะพะดะตะปั

```
โโโโโโโโโโโโโโโโ         HTTP Request          โโโโโโโโโโโโโโโโ
โ              โ  โโโโโโโโโโโโโโโโโโโโโโโโโโบ   โ              โ
โ   ะัะฐัะทะตั    โ                               โ    ะกะตัะฒะตั    โ
โ   (ะะปะธะตะฝั)   โ                               โ    (PHP)     โ
โ              โ   โโโโโโโโโโโโโโโโโโโโโโโโโโ  โ              โ
โโโโโโโโโโโโโโโโ         HTTP Response         โโโโโโโโโโโโโโโโ

ะฆะธะบะป ะทะฐะฟัะพั-ะพัะฒะตั:
1. ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั URL ะธะปะธ ะบะปะธะบะฐะตั ัััะปะบั
2. ะัะฐัะทะตั ัะพัะผะธััะตั HTTP-ะทะฐะฟัะพั ะธ ะพัะฟัะฐะฒะปัะตั ัะตัะฒะตัั
3. ะกะตัะฒะตั ะพะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั (PHP-ัะบัะธะฟั)
4. ะกะตัะฒะตั ัะพัะผะธััะตั HTTP-ะพัะฒะตั
5. ะัะฐัะทะตั ะฟะพะปััะฐะตั ะพัะฒะตั ะธ ะพัะพะฑัะฐะถะฐะตั ัััะฐะฝะธัั
```

### ะกัััะบัััะฐ HTTP-ะทะฐะฟัะพัะฐ

```http
POST /login.php HTTP/1.1                    โ ะกัะฐััะพะฒะฐั ัััะพะบะฐ
Host: example.com                           โ ะะฐะณะพะปะพะฒะบะธ
Content-Type: application/x-www-form-urlencoded
Content-Length: 29
Cookie: session_id=abc123
User-Agent: Mozilla/5.0
                                            โ ะัััะฐั ัััะพะบะฐ
username=ivan&password=secret               โ ะขะตะปะพ ะทะฐะฟัะพัะฐ (ะดะปั POST)
```

### ะกัััะบัััะฐ HTTP-ะพัะฒะตัะฐ

```http
HTTP/1.1 200 OK                             โ ะกัะฐัััะฝะฐั ัััะพะบะฐ
Content-Type: text/html; charset=UTF-8      โ ะะฐะณะพะปะพะฒะบะธ
Content-Length: 1234
Set-Cookie: session_id=xyz789
Cache-Control: no-cache
                                            โ ะัััะฐั ัััะพะบะฐ
<!DOCTYPE html>                             โ ะขะตะปะพ ะพัะฒะตัะฐ
<html>...
```

### ะะพะดั ัะพััะพัะฝะธั HTTP

```
โโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะพะด   โ ะะฟะธัะฐะฝะธะต                                               โ
โโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 1xx   โ ะะฝัะพัะผะฐัะธะพะฝะฝัะต                                         โ
โ 2xx   โ ะฃัะฟะตั                                                  โ
โ  200  โ   OK โ ะทะฐะฟัะพั ััะฟะตัะตะฝ                                  โ
โ  201  โ   Created โ ัะตัััั ัะพะทะดะฐะฝ                              โ
โ  204  โ   No Content โ ััะฟะตั, ะฝะพ ัะตะปะพ ะฟัััะพะต                   โ
โ 3xx   โ ะะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธะต                                        โ
โ  301  โ   Moved Permanently โ ะฟะพััะพัะฝะฝัะน ัะตะดะธัะตะบั              โ
โ  302  โ   Found โ ะฒัะตะผะตะฝะฝัะน ัะตะดะธัะตะบั                           โ
โ  304  โ   Not Modified โ ะธัะฟะพะปัะทะพะฒะฐัั ะบะตั                      โ
โ 4xx   โ ะัะธะฑะบะฐ ะบะปะธะตะฝัะฐ                                         โ
โ  400  โ   Bad Request โ ะฝะตะฒะตัะฝัะน ะทะฐะฟัะพั                        โ
โ  401  โ   Unauthorized โ ััะตะฑัะตััั ะฐะฒัะพัะธะทะฐัะธั                 โ
โ  403  โ   Forbidden โ ะดะพัััะฟ ะทะฐะฟัะตััะฝ                          โ
โ  404  โ   Not Found โ ัะตัััั ะฝะต ะฝะฐะนะดะตะฝ                         โ
โ  405  โ   Method Not Allowed โ ะผะตัะพะด ะฝะต ัะฐะทัะตััะฝ               โ
โ  422  โ   Unprocessable Entity โ ะพัะธะฑะบะฐ ะฒะฐะปะธะดะฐัะธะธ              โ
โ  429  โ   Too Many Requests โ ัะปะธัะบะพะผ ะผะฝะพะณะพ ะทะฐะฟัะพัะพะฒ           โ
โ 5xx   โ ะัะธะฑะบะฐ ัะตัะฒะตัะฐ                                         โ
โ  500  โ   Internal Server Error โ ะพัะธะฑะบะฐ ัะตัะฒะตัะฐ               โ
โ  502  โ   Bad Gateway โ ะพัะธะฑะบะฐ ัะปัะทะฐ                           โ
โ  503  โ   Service Unavailable โ ัะตัะฒะธั ะฝะตะดะพัััะฟะตะฝ              โ
โโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 2. HTTP ะผะตัะพะดั

### ะัะฝะพะฒะฝัะต ะผะตัะพะดั

```
โโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะตัะพะด   โ ะะฐะทะฝะฐัะตะฝะธะต                                           โ
โโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ GET     โ ะะพะปััะธัั ะดะฐะฝะฝัะต (ัััะฐะฝะธัั, ัะฐะนะป, API-ะพัะฒะตั)         โ
โ POST    โ ะัะฟัะฐะฒะธัั ะดะฐะฝะฝัะต (ัะพัะผั, ัะพะทะดะฐะฝะธะต ัะตััััะฐ)          โ
โ PUT     โ ะะฐะผะตะฝะธัั ัะตัััั ัะตะปะธะบะพะผ                             โ
โ PATCH   โ ะงะฐััะธัะฝะพ ะพะฑะฝะพะฒะธัั ัะตัััั                            โ
โ DELETE  โ ะฃะดะฐะปะธัั ัะตัััั                                      โ
โ HEAD    โ ะะพะปััะธัั ัะพะปัะบะพ ะทะฐะณะพะปะพะฒะบะธ (ะฑะตะท ัะตะปะฐ)                โ
โ OPTIONS โ ะฃะทะฝะฐัั ะฟะพะดะดะตัะถะธะฒะฐะตะผัะต ะผะตัะพะดั                        โ
โโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### GET vs POST

```
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะฅะฐัะฐะบัะตัะธััะธะบะฐ โ GET                 โ POST                    โ
โโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ะะฐะฝะฝัะต         โ ะ URL (?key=value)  โ ะ ัะตะปะต ะทะฐะฟัะพัะฐ          โ
โ ะะธะดะธะผะพััั      โ ะะธะดะฝั ะฒ ะฐะดัะตัะฝะพะน    โ ะกะบัััั ะพั ะฟะพะปัะทะพะฒะฐัะตะปั  โ
โ                โ ัััะพะบะต              โ                         โ
โ ะะฐะบะปะฐะดะบะธ       โ ะะพะถะฝะพ ัะพััะฐะฝะธัั     โ ะะตะปัะทั ัะพััะฐะฝะธัั        โ
โ ะะตัะธัะพะฒะฐะฝะธะต    โ ะะตัะธััะตััั          โ ะะต ะบะตัะธััะตััั           โ
โ ะะฐะทะผะตั ะดะฐะฝะฝัั  โ ะะณัะฐะฝะธัะตะฝ (~2KB)    โ ะัะฐะบัะธัะตัะบะธ ะฑะตะทะปะธะผะธัะฝะพ  โ
โ ะะตะทะพะฟะฐัะฝะพััั   โ ะะตะฝะตะต ะฑะตะทะพะฟะฐัะตะฝ     โ ะะพะปะตะต ะฑะตะทะพะฟะฐัะตะฝ         โ
โ ะะดะตะผะฟะพัะตะฝัะฝะพัััโ ะะฐ (ะฟะพะฒัะพั = ัะพ ะถะต) โ ะะตั (ะฟะพะฒัะพั โ ัะพ ะถะต)    โ
โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต  โ ะะพะปััะตะฝะธะต ะดะฐะฝะฝัั    โ ะัะฟัะฐะฒะบะฐ/ะธะทะผะตะฝะตะฝะธะต      โ
โโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั GET

```php
<?php
// โ GET โ ะดะปั ะฟะพะปััะตะฝะธั ะดะฐะฝะฝัั

// ะัะพัะผะพัั ัััะฐะฝะธัั
// GET /products.php?category=phones

// ะะพะธัะบ
// GET /search.php?q=iphone

// ะะฐะณะธะฝะฐัะธั
// GET /articles.php?page=2

// ะคะธะปัััะฐัะธั
// GET /catalog.php?brand=apple&price_min=1000
```

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั POST

```php
<?php
// โ POST โ ะดะปั ะพัะฟัะฐะฒะบะธ/ะธะทะผะตะฝะตะฝะธั ะดะฐะฝะฝัั

// ะะฒัะพัะธะทะฐัะธั
// POST /login.php (username, password)

// ะะตะณะธัััะฐัะธั
// POST /register.php (name, email, password)

// ะกะพะทะดะฐะฝะธะต ะทะฐะฟะธัะธ
// POST /articles.php (title, content)

// ะะฐะณััะทะบะฐ ัะฐะนะปะฐ
// POST /upload.php (file)

// ะัะพัะผะปะตะฝะธะต ะทะฐะบะฐะทะฐ
// POST /checkout.php (cart, address, payment)
```

---

## 3. ะกัะฟะตัะณะปะพะฑะฐะปัะฝัะต ะผะฐััะธะฒั

### $_GET โ ะดะฐะฝะฝัะต ะธะท URL

```php
<?php
// URL: /search.php?q=php&page=2&sort=date

// ะะพะปััะตะฝะธะต ะฟะฐัะฐะผะตััะพะฒ
$query = $_GET['q'];      // "php"
$page = $_GET['page'];    // "2" (ัััะพะบะฐ!)
$sort = $_GET['sort'];    // "date"

// ะะตะทะพะฟะฐัะฝะพะต ะฟะพะปััะตะฝะธะต ั ะทะฝะฐัะตะฝะธะตะผ ะฟะพ ัะผะพะปัะฐะฝะธั
$query = $_GET['q'] ?? '';
$page = (int) ($_GET['page'] ?? 1);
$sort = $_GET['sort'] ?? 'date';

// ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั ะฟะฐัะฐะผะตััะฐ
if (isset($_GET['q'])) {
    // ะะฐัะฐะผะตัั ะฟะตัะตะดะฐะฝ
}

if (!empty($_GET['q'])) {
    // ะะฐัะฐะผะตัั ะฟะตัะตะดะฐะฝ ะธ ะฝะต ะฟัััะพะน
}

// filter_input โ ะฑะพะปะตะต ะฑะตะทะพะฟะฐัะฝัะน ัะฟะพัะพะฑ
$page = filter_input(INPUT_GET, 'page', FILTER_VALIDATE_INT) ?: 1;
$email = filter_input(INPUT_GET, 'email', FILTER_VALIDATE_EMAIL);
```

### $_POST โ ะดะฐะฝะฝัะต ะธะท ัะพัะผั

```php
<?php
// ะคะพัะผะฐ ะพัะฟัะฐะฒะปะตะฝะฐ ะผะตัะพะดะพะผ POST
// <form method="POST" action="login.php">
//   <input name="username">
//   <input name="password" type="password">
// </form>

// ะะพะปััะตะฝะธะต ะดะฐะฝะฝัั
$username = $_POST['username'] ?? '';
$password = $_POST['password'] ?? '';

// ะัะพะฒะตัะบะฐ ะผะตัะพะดะฐ ะทะฐะฟัะพัะฐ
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // ะคะพัะผะฐ ะพัะฟัะฐะฒะปะตะฝะฐ
    $username = trim($_POST['username'] ?? '');
    $password = $_POST['password'] ?? '';
    
    // ะะฐะปะธะดะฐัะธั
    if (empty($username) || empty($password)) {
        $error = 'ะะฐะฟะพะปะฝะธัะต ะฒัะต ะฟะพะปั';
    }
}

// filter_input ะดะปั POST
$email = filter_input(INPUT_POST, 'email', FILTER_VALIDATE_EMAIL);
$age = filter_input(INPUT_POST, 'age', FILTER_VALIDATE_INT, [
    'options' => ['min_range' => 1, 'max_range' => 150]
]);
```

### $_REQUEST โ GET + POST + COOKIE

```php
<?php
// $_REQUEST ัะพะดะตัะถะธั ะดะฐะฝะฝัะต ะธะท $_GET, $_POST ะธ $_COOKIE
// ะะพััะดะพะบ ะพะฟัะตะดะตะปัะตััั ะฒ php.ini (request_order)

$value = $_REQUEST['key'];

// โ๏ธ ะัััะต ะธะทะฑะตะณะฐัั $_REQUEST!
// ะฏะฒะฝะพ ัะบะฐะทัะฒะฐะน ะธััะพัะฝะธะบ ะดะฐะฝะฝัั:
$getParam = $_GET['param'] ?? null;
$postParam = $_POST['param'] ?? null;
```

### $_SERVER โ ะธะฝัะพัะผะฐัะธั ะพ ัะตัะฒะตัะต ะธ ะทะฐะฟัะพัะต

```php
<?php
// ะะตัะพะด ะทะฐะฟัะพัะฐ
echo $_SERVER['REQUEST_METHOD'];  // GET, POST, PUT...

// URI ะทะฐะฟัะพัะฐ
echo $_SERVER['REQUEST_URI'];     // /page.php?id=5

// ะััั ะบ ัะบัะธะฟัั
echo $_SERVER['SCRIPT_NAME'];     // /page.php

// Query string
echo $_SERVER['QUERY_STRING'];    // id=5

// ะฅะพัั
echo $_SERVER['HTTP_HOST'];       // example.com
echo $_SERVER['SERVER_NAME'];     // example.com

// IP ะบะปะธะตะฝัะฐ
echo $_SERVER['REMOTE_ADDR'];     // 192.168.1.1

// User Agent
echo $_SERVER['HTTP_USER_AGENT']; // Mozilla/5.0...

// Referer (ะพัะบัะดะฐ ะฟัะธััะป)
echo $_SERVER['HTTP_REFERER'];    // https://google.com/

// HTTPS
$isHttps = !empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off';

// ะะพะปะฝัะน URL
$protocol = $isHttps ? 'https' : 'http';
$fullUrl = $protocol . '://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];

// ะััั ะบ ะดะพะบัะผะตะฝัะฐะผ
echo $_SERVER['DOCUMENT_ROOT'];   // /var/www/html

// ะะพัั
echo $_SERVER['SERVER_PORT'];     // 80 ะธะปะธ 443
```

### ะัะฐะบัะธัะตัะบะธะน ะฟัะธะผะตั: ัะพััะตั

```php
<?php
// ะัะพััะพะน ัะพััะตั ะฝะฐ ะพัะฝะพะฒะต $_SERVER

$method = $_SERVER['REQUEST_METHOD'];
$uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);

// ะฃะดะฐะปะธัั trailing slash
$uri = rtrim($uri, '/') ?: '/';

// ะะพััะธะฝะณ
switch (true) {
    case $uri === '/' && $method === 'GET':
        // ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
        include 'pages/home.php';
        break;
        
    case $uri === '/about' && $method === 'GET':
        // ะ ะฝะฐั
        include 'pages/about.php';
        break;
        
    case preg_match('#^/products/(\d+)$#', $uri, $matches) && $method === 'GET':
        // ะัะพัะผะพัั ัะพะฒะฐัะฐ: /products/123
        $productId = (int) $matches[1];
        include 'pages/product.php';
        break;
        
    case $uri === '/login' && $method === 'GET':
        // ะคะพัะผะฐ ะปะพะณะธะฝะฐ
        include 'pages/login-form.php';
        break;
        
    case $uri === '/login' && $method === 'POST':
        // ะะฑัะฐะฑะพัะบะฐ ะปะพะณะธะฝะฐ
        include 'pages/login-process.php';
        break;
        
    default:
        // 404
        http_response_code(404);
        include 'pages/404.php';
}
```

---

## 4. HTTP ะทะฐะณะพะปะพะฒะบะธ

### ะัะฟัะฐะฒะบะฐ ะทะฐะณะพะปะพะฒะบะพะฒ ะฒ PHP

```php
<?php
// ะะะะะ: ะทะฐะณะพะปะพะฒะบะธ ะดะพะปะถะฝั ะฑััั ะพัะฟัะฐะฒะปะตะฝั ะะ ะปัะฑะพะณะพ ะฒัะฒะพะดะฐ!

// ะฃััะฐะฝะพะฒะบะฐ ะทะฐะณะพะปะพะฒะบะฐ
header('Content-Type: text/html; charset=UTF-8');

// ะกัะฐััั ะพัะฒะตัะฐ
header('HTTP/1.1 404 Not Found');
// ะะปะธ:
http_response_code(404);

// ะะตะดะธัะตะบั
header('Location: /new-page.php');
exit;  // ะะฐะถะฝะพ! ะัะตะบัะฐัะธัั ะฒัะฟะพะปะฝะตะฝะธะต ะฟะพัะปะต ัะตะดะธัะตะบัะฐ

// ะะตะดะธัะตะบั ั ะบะพะดะพะผ 301 (ะฟะพััะพัะฝะฝัะน)
header('Location: /new-url.php', true, 301);
exit;

// ะะฐะฟัะตั ะบะตัะธัะพะฒะฐะฝะธั
header('Cache-Control: no-store, no-cache, must-revalidate');
header('Pragma: no-cache');
header('Expires: 0');

// ะะตัะธัะพะฒะฐะฝะธะต ะฝะฐ 1 ัะฐั
header('Cache-Control: public, max-age=3600');
header('Expires: ' . gmdate('D, d M Y H:i:s', time() + 3600) . ' GMT');

// ะขะธะฟ ะบะพะฝัะตะฝัะฐ
header('Content-Type: application/json');
header('Content-Type: text/plain');
header('Content-Type: image/png');

// ะกะบะฐัะธะฒะฐะฝะธะต ัะฐะนะปะฐ
header('Content-Type: application/octet-stream');
header('Content-Disposition: attachment; filename="document.pdf"');
header('Content-Length: ' . filesize($file));

// CORS (ะดะปั API)
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, PUT, DELETE');
header('Access-Control-Allow-Headers: Content-Type, Authorization');
```

### ะัะพะฒะตัะบะฐ: ะพัะฟัะฐะฒะปะตะฝั ะปะธ ะทะฐะณะพะปะพะฒะบะธ?

```php
<?php
// ะัะพะฒะตัะธัั, ะพัะฟัะฐะฒะปะตะฝั ะปะธ ัะถะต ะทะฐะณะพะปะพะฒะบะธ
if (headers_sent($file, $line)) {
    die("ะะฐะณะพะปะพะฒะบะธ ัะถะต ะพัะฟัะฐะฒะปะตะฝั ะฒ $file ะฝะฐ ัััะพะบะต $line");
}

// ะะตะทะพะฟะฐัะฝัะน ัะตะดะธัะตะบั
function redirect(string $url): void {
    if (headers_sent()) {
        // Fallback: JavaScript ัะตะดะธัะตะบั
        echo "<script>window.location.href='$url';</script>";
        echo "<noscript><meta http-equiv='refresh' content='0;url=$url'></noscript>";
    } else {
        header('Location: ' . $url);
    }
    exit;
}
```

### ะะพะปััะตะฝะธะต ะทะฐะณะพะปะพะฒะบะพะฒ ะทะฐะฟัะพัะฐ

```php
<?php
// ะัะต ะทะฐะณะพะปะพะฒะบะธ ะทะฐะฟัะพัะฐ
$headers = getallheaders();
print_r($headers);
/*
[
    'Host' => 'example.com',
    'User-Agent' => 'Mozilla/5.0...',
    'Accept' => 'text/html',
    'Authorization' => 'Bearer token123',
    ...
]
*/

// ะะพะฝะบัะตัะฝัะน ะทะฐะณะพะปะพะฒะพะบ
$authHeader = $_SERVER['HTTP_AUTHORIZATION'] ?? '';
$contentType = $_SERVER['CONTENT_TYPE'] ?? '';
$userAgent = $_SERVER['HTTP_USER_AGENT'] ?? '';

// ะคัะฝะบัะธั ะดะปั ะฟะพะปััะตะฝะธั ะทะฐะณะพะปะพะฒะบะฐ
function getHeader(string $name): ?string {
    $headers = getallheaders();
    
    // ะะฐะณะพะปะพะฒะบะธ ัะตะณะธัััะพะฝะตะทะฐะฒะธัะธะผั
    foreach ($headers as $key => $value) {
        if (strcasecmp($key, $name) === 0) {
            return $value;
        }
    }
    
    return null;
}

$auth = getHeader('Authorization');
```

### ะัะฐะบัะธัะตัะบะธะน ะฟัะธะผะตั: JSON API

```php
<?php
// api.php โ ะฟัะพััะพะน JSON API

header('Content-Type: application/json; charset=UTF-8');
header('Access-Control-Allow-Origin: *');

// ะคัะฝะบัะธั ะพัะฒะตัะฐ
function jsonResponse(mixed $data, int $code = 200): never {
    http_response_code($code);
    echo json_encode($data, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
    exit;
}

// ะคัะฝะบัะธั ะพัะธะฑะบะธ
function jsonError(string $message, int $code = 400): never {
    jsonResponse(['error' => true, 'message' => $message], $code);
}

// ะะพะปััะตะฝะธะต JSON ะธะท ัะตะปะฐ ะทะฐะฟัะพัะฐ
function getJsonInput(): array {
    $input = file_get_contents('php://input');
    $data = json_decode($input, true);
    
    if (json_last_error() !== JSON_ERROR_NONE) {
        jsonError('Invalid JSON', 400);
    }
    
    return $data ?? [];
}

// ะะพััะธะฝะณ
$method = $_SERVER['REQUEST_METHOD'];
$uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);

// ะะฑัะฐะฑะพัะบะฐ preflight ะทะฐะฟัะพัะพะฒ (CORS)
if ($method === 'OPTIONS') {
    header('Access-Control-Allow-Methods: GET, POST, PUT, DELETE');
    header('Access-Control-Allow-Headers: Content-Type, Authorization');
    exit;
}

// ะัะธะผะตัั ัะฝะดะฟะพะธะฝัะพะฒ
switch (true) {
    case $uri === '/api/users' && $method === 'GET':
        // ะะพะปััะธัั ัะฟะธัะพะบ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
        $users = [
            ['id' => 1, 'name' => 'ะะฒะฐะฝ'],
            ['id' => 2, 'name' => 'ะะฐัะธั'],
        ];
        jsonResponse(['users' => $users]);
        break;
        
    case $uri === '/api/users' && $method === 'POST':
        // ะกะพะทะดะฐัั ะฟะพะปัะทะพะฒะฐัะตะปั
        $data = getJsonInput();
        
        if (empty($data['name'])) {
            jsonError('Name is required');
        }
        
        // ะกะพะทะดะฐะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั...
        jsonResponse(['id' => 3, 'name' => $data['name']], 201);
        break;
        
    default:
        jsonError('Not found', 404);
}
```

---

## 5. Cookies (ะบัะบะธ)

### ะงัะพ ัะฐะบะพะต cookies?

**Cookies** โ ะฝะตะฑะพะปััะธะต ััะฐะณะผะตะฝัั ะดะฐะฝะฝัั, ะบะพัะพััะต ัะตัะฒะตั ะพัะฟัะฐะฒะปัะตั ะฑัะฐัะทะตัั, ะฐ ะฑัะฐัะทะตั ัะพััะฐะฝัะตั ะธ ะพัะฟัะฐะฒะปัะตั ะพะฑัะฐัะฝะพ ั ะบะฐะถะดัะผ ะทะฐะฟัะพัะพะผ.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ะะะ ะะะะะขะะฎะข COOKIES                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                  โ
โ  1. ะกะตัะฒะตั ะพัะฟัะฐะฒะปัะตั cookie:                                   โ
โ     Set-Cookie: user_id=123; Path=/; HttpOnly                   โ
โ                                                                  โ
โ  2. ะัะฐัะทะตั ัะพััะฐะฝัะตั cookie                                    โ
โ                                                                  โ
โ  3. ะัะธ ัะปะตะดัััะธั ะทะฐะฟัะพัะฐั ะฑัะฐัะทะตั ะพัะฟัะฐะฒะปัะตั:                  โ
โ     Cookie: user_id=123                                         โ
โ                                                                  โ
โ  4. ะกะตัะฒะตั ัะธัะฐะตั cookie ะธ "ัะทะฝะฐัั" ะฟะพะปัะทะพะฒะฐัะตะปั                โ
โ                                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะฃััะฐะฝะพะฒะบะฐ cookies

```php
<?php
// ะะฐะทะพะฒะฐั ัััะฐะฝะพะฒะบะฐ
setcookie('username', 'ivan');

// ะก ะฒัะตะผะตะฝะตะผ ะถะธะทะฝะธ (1 ัะฐั)
setcookie('remember_me', 'yes', time() + 3600);

// ะก ะฟะพะปะฝัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ (PHP 7.3+)
setcookie('session_token', 'abc123', [
    'expires' => time() + 86400 * 30,  // 30 ะดะฝะตะน
    'path' => '/',                      // ะะพัััะฟะฝะฐ ะฝะฐ ะฒััะผ ัะฐะนัะต
    'domain' => '.example.com',         // ะะบะปััะฐั ะฟะพะดะดะพะผะตะฝั
    'secure' => true,                   // ะขะพะปัะบะพ ัะตัะตะท HTTPS
    'httponly' => true,                 // ะะตะดะพัััะฟะฝะฐ ะธะท JavaScript
    'samesite' => 'Lax',               // ะะฐัะธัะฐ ะพั CSRF
]);

// ะกัะฐััะน ัะธะฝัะฐะบัะธั (ะดะพ PHP 7.3)
setcookie(
    'old_style',
    'value',
    time() + 3600,  // expires
    '/',            // path
    '.example.com', // domain
    true,           // secure
    true            // httponly
);
```

### ะะฐัะฐะผะตััั cookies

```
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะฐัะฐะผะตัั    โ ะะฟะธัะฐะฝะธะต                                             โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ name        โ ะะผั ะบัะบะธ                                             โ
โ value       โ ะะฝะฐัะตะฝะธะต (ัััะพะบะฐ)                                    โ
โ expires     โ Unix timestamp ะบะพะณะดะฐ ะธััะตััั (0 = ัะตััะธะพะฝะฝะฐั)        โ
โ path        โ ะััั ะฝะฐ ัะฐะนัะต ะณะดะต ะดะพัััะฟะฝะฐ ('/' = ะฒะตัั ัะฐะนั)        โ
โ domain      โ ะะพะผะตะฝ ('.site.com' ะฒะบะปััะฐะตั ะฟะพะดะดะพะผะตะฝั)              โ
โ secure      โ ะะตัะตะดะฐะฒะฐัั ัะพะปัะบะพ ัะตัะตะท HTTPS                        โ
โ httponly    โ ะะตะดะพัััะฟะฝะฐ ะธะท JavaScript (ะทะฐัะธัะฐ ะพั XSS)            โ
โ samesite    โ Strict/Lax/None โ ะทะฐัะธัะฐ ะพั CSRF                    โ
โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะงัะตะฝะธะต cookies

```php
<?php
// Cookies ะดะพัััะฟะฝั ะฒ $_COOKIE

// ะัะพะฒะตัะบะฐ ัััะตััะฒะพะฒะฐะฝะธั
if (isset($_COOKIE['username'])) {
    echo "ะัะธะฒะตั, " . htmlspecialchars($_COOKIE['username']);
}

// ะะตะทะพะฟะฐัะฝะพะต ะฟะพะปััะตะฝะธะต
$username = $_COOKIE['username'] ?? 'ะะพััั';
$theme = $_COOKIE['theme'] ?? 'light';

// ะะะะะ: $_COOKIE ัะพะดะตัะถะธั ะทะฝะฐัะตะฝะธั ะฝะฐ ะผะพะผะตะฝั ะะะงะะะ ะทะฐะฟัะพัะฐ!
// ะัะปะธ ะฒั ัััะฐะฝะพะฒะธะปะธ ะบัะบั ัะตัะตะท setcookie(), ะพะฝะฐ ะฟะพัะฒะธััั
// ะฒ $_COOKIE ัะพะปัะบะพ ะฟัะธ ะกะะะะฃะฎะฉะะ ะทะฐะฟัะพัะต!

setcookie('test', 'value');
echo $_COOKIE['test'];  // โ ะะต ััะฐะฑะพัะฐะตั ะฒ ััะพะผ ะถะต ะทะฐะฟัะพัะต!

// ะะฑัะพะดะฝะพะน ะฟััั:
setcookie('test', 'value');
$_COOKIE['test'] = 'value';  // ะััะฝะฐั ัััะฐะฝะพะฒะบะฐ ะดะปั ัะตะบััะตะณะพ ะทะฐะฟัะพัะฐ
```

### ะฃะดะฐะปะตะฝะธะต cookies

```php
<?php
// ะฃััะฐะฝะพะฒะธัั ะฒัะตะผั ะธััะตัะตะฝะธั ะฒ ะฟัะพัะปะพะผ
setcookie('username', '', time() - 3600);

// ะะปะธ ั ัะตะผะธ ะถะต ะฟะฐัะฐะผะตััะฐะผะธ, ััะพ ะธ ะฟัะธ ัััะฐะฝะพะฒะบะต
setcookie('session_token', '', [
    'expires' => time() - 3600,
    'path' => '/',
    'domain' => '.example.com',
    'secure' => true,
    'httponly' => true,
]);

// ะคัะฝะบัะธั ัะดะฐะปะตะฝะธั
function deleteCookie(string $name, string $path = '/', string $domain = ''): void {
    setcookie($name, '', [
        'expires' => time() - 3600,
        'path' => $path,
        'domain' => $domain,
    ]);
    unset($_COOKIE[$name]);
}
```

### ะัะฐะบัะธัะตัะบะธะน ะฟัะธะผะตั: "ะะฐะฟะพะผะฝะธัั ะผะตะฝั"

```php
<?php
// ะะตะฝะตัะฐัะธั ัะพะบะตะฝะฐ ะฟัะธ ะปะพะณะธะฝะต
function createRememberToken(int $userId): string {
    $token = bin2hex(random_bytes(32));
    
    // ะกะพััะฐะฝะธัั ัะตั ัะพะบะตะฝะฐ ะฒ ะะ
    $hashedToken = hash('sha256', $token);
    saveTokenToDatabase($userId, $hashedToken, time() + 86400 * 30);
    
    return $token;
}

// ะฃััะฐะฝะพะฒะบะฐ ะบัะบะธ "ะะฐะฟะพะผะฝะธัั ะผะตะฝั"
function setRememberCookie(int $userId): void {
    $token = createRememberToken($userId);
    
    setcookie('remember_token', $userId . ':' . $token, [
        'expires' => time() + 86400 * 30,  // 30 ะดะฝะตะน
        'path' => '/',
        'secure' => true,
        'httponly' => true,
        'samesite' => 'Lax',
    ]);
}

// ะัะพะฒะตัะบะฐ ัะพะบะตะฝะฐ ะฟัะธ ะทะฐะณััะทะบะต ัััะฐะฝะธัั
function checkRememberCookie(): ?int {
    if (!isset($_COOKIE['remember_token'])) {
        return null;
    }
    
    $parts = explode(':', $_COOKIE['remember_token'], 2);
    if (count($parts) !== 2) {
        return null;
    }
    
    [$userId, $token] = $parts;
    $hashedToken = hash('sha256', $token);
    
    // ะัะพะฒะตัะธัั ัะพะบะตะฝ ะฒ ะะ
    if (validateTokenInDatabase($userId, $hashedToken)) {
        return (int) $userId;
    }
    
    // ะขะพะบะตะฝ ะฝะตะฒะฐะปะธะดะฝัะน โ ัะดะฐะปะธัั ะบัะบั
    deleteCookie('remember_token');
    return null;
}
```

### SameSite โ ะทะฐัะธัะฐ ะพั CSRF

```php
<?php
// SameSite ะบะพะฝััะพะปะธััะตั ะพัะฟัะฐะฒะบั cookies ะฟัะธ cross-site ะทะฐะฟัะพัะฐั

// Strict โ ะบัะบะธ ะะ ะพัะฟัะฐะฒะปััััั ะฟัะธ ะฟะตัะตัะพะดะต ั ะดััะณะพะณะพ ัะฐะนัะฐ
// (ะดะฐะถะต ะฟะพ ะพะฑััะฝะพะน ัััะปะบะต!)
setcookie('auth', 'token', ['samesite' => 'Strict']);

// Lax โ ะบัะบะธ ะพัะฟัะฐะฒะปััััั ัะพะปัะบะพ ะฟัะธ "ะฑะตะทะพะฟะฐัะฝัั" ะฟะตัะตัะพะดะฐั
// (ัััะปะบะธ, ะฝะพ ะะ ัะพัะผั ะธ ะะ AJAX ั ะดััะณะพะณะพ ัะฐะนัะฐ)
setcookie('auth', 'token', ['samesite' => 'Lax']);  // ะะตะบะพะผะตะฝะดัะตััั!

// None โ ะบัะบะธ ะพัะฟัะฐะฒะปััััั ะฒัะตะณะดะฐ (ััะตะฑัะตั secure=true)
// ะัะถะฝะพ ะดะปั ะฒะธะดะถะตัะพะฒ, ะฒัััะฐะธะฒะฐะตะผัั ะฝะฐ ะดััะณะธะต ัะฐะนัั
setcookie('widget', 'data', ['samesite' => 'None', 'secure' => true]);
```

---

## 6. ะกะตััะธะธ (Sessions)

### ะงัะพ ัะฐะบะพะต ัะตััะธะธ?

**ะกะตััะธั** โ ะผะตัะฐะฝะธะทะผ ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปั ะผะตะถะดั ะทะฐะฟัะพัะฐะผะธ ะฝะฐ ัะตัะฒะตัะต. ะ ะพัะปะธัะธะต ะพั cookies, ะดะฐะฝะฝัะต ััะฐะฝัััั ะฝะฐ ัะตัะฒะตัะต, ะฐ ะฝะต ั ะบะปะธะตะฝัะฐ.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ะะะ ะะะะะขะะฎะข ะกะะกะกะะ                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                  โ
โ  1. ะะพะปัะทะพะฒะฐัะตะปั ะทะฐัะพะดะธั ะฝะฐ ัะฐะนั                                โ
โ                                                                  โ
โ  2. PHP ัะพะทะดะฐัั ัะฝะธะบะฐะปัะฝัะน SESSION ID (ะฝะฐะฟัะธะผะตั: abc123...)     โ
โ                                                                  โ
โ  3. SESSION ID ะพัะฟัะฐะฒะปัะตััั ะบะปะธะตะฝัั ัะตัะตะท cookie (PHPSESSID)    โ
โ                                                                  โ
โ  4. ะะฐ ัะตัะฒะตัะต ัะพะทะดะฐัััั ัะฐะนะป /tmp/sess_abc123... ั ะดะฐะฝะฝัะผะธ     โ
โ                                                                  โ
โ  5. ะัะธ ัะปะตะดัััะตะผ ะทะฐะฟัะพัะต ะฑัะฐัะทะตั ะพัะฟัะฐะฒะปัะตั PHPSESSID          โ
โ                                                                  โ
โ  6. PHP ัะธัะฐะตั ัะฐะนะป ัะตััะธะธ ะธ ะฒะพัััะฐะฝะฐะฒะปะธะฒะฐะตั $_SESSION          โ
โ                                                                  โ
โ  ะะปะธะตะฝั:  Cookie: PHPSESSID=abc123...                           โ
โ  ะกะตัะฒะตั:  /tmp/sess_abc123... โ ['user_id' => 1, 'cart' => [...]]โ
โ                                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะฐะทะพะฒะฐั ัะฐะฑะพัะฐ ั ัะตััะธัะผะธ

```php
<?php
// ะะะะะ: session_start() ะดะพะปะถะตะฝ ะฑััั ะฒัะทะฒะฐะฝ ะะ ะปัะฑะพะณะพ ะฒัะฒะพะดะฐ!

// ะะฐัะฐัั ัะตััะธั
session_start();

// ะะฐะฟะธัะฐัั ะดะฐะฝะฝัะต ะฒ ัะตััะธั
$_SESSION['user_id'] = 123;
$_SESSION['username'] = 'ivan';
$_SESSION['cart'] = ['item1', 'item2'];

// ะัะพัะธัะฐัั ะดะฐะฝะฝัะต
$userId = $_SESSION['user_id'] ?? null;
$username = $_SESSION['username'] ?? 'ะะพััั';

// ะัะพะฒะตัะธัั ะฝะฐะปะธัะธะต
if (isset($_SESSION['user_id'])) {
    echo "ะะพะปัะทะพะฒะฐัะตะปั ะฐะฒัะพัะธะทะพะฒะฐะฝ";
}

// ะฃะดะฐะปะธัั ะพะดะฝะพ ะทะฝะฐัะตะฝะธะต
unset($_SESSION['cart']);

// ะะพะปััะธัั ID ัะตััะธะธ
$sessionId = session_id();
echo "Session ID: $sessionId";

// ะะตะณะตะฝะตัะธัะพะฒะฐัั ID (ะฟะพัะปะต ะปะพะณะธะฝะฐ โ ะดะปั ะฑะตะทะพะฟะฐัะฝะพััะธ!)
session_regenerate_id(true);
```

### ะฃะฝะธััะพะถะตะฝะธะต ัะตััะธะธ

```php
<?php
session_start();

// ะกะฟะพัะพะฑ 1: ะัะธััะธัั ะฒัะต ะดะฐะฝะฝัะต
$_SESSION = [];

// ะกะฟะพัะพะฑ 2: ะะพะปะฝะพะต ัะฝะธััะพะถะตะฝะธะต ัะตััะธะธ (logout)
function logout(): void {
    // ะัะธััะธัั ะดะฐะฝะฝัะต
    $_SESSION = [];
    
    // ะฃะดะฐะปะธัั cookie ัะตััะธะธ
    if (ini_get('session.use_cookies')) {
        $params = session_get_cookie_params();
        setcookie(
            session_name(),
            '',
            time() - 3600,
            $params['path'],
            $params['domain'],
            $params['secure'],
            $params['httponly']
        );
    }
    
    // ะฃะฝะธััะพะถะธัั ัะตััะธั
    session_destroy();
}
```

### ะะฐัััะพะนะบะฐ ัะตััะธะน

```php
<?php
// ะะฐัััะพะนะบะฐ ะะ session_start()

// ะะผั cookie ัะตััะธะธ (ะฟะพ ัะผะพะปัะฐะฝะธั PHPSESSID)
session_name('MYSESSID');

// ะัะตะผั ะถะธะทะฝะธ cookie (0 = ะดะพ ะทะฐะบัััะธั ะฑัะฐัะทะตัะฐ)
session_set_cookie_params([
    'lifetime' => 0,
    'path' => '/',
    'domain' => '.example.com',
    'secure' => true,
    'httponly' => true,
    'samesite' => 'Lax',
]);

// ะะฐะฟะบะฐ ะดะปั ัะฐะนะปะพะฒ ัะตััะธะน
session_save_path('/var/www/sessions');

// ะขะตะฟะตัั ะทะฐะฟััะบะฐะตะผ
session_start();

// ะะปะธ ัะตัะตะท php.ini / .htaccess:
// session.name = "MYSESSID"
// session.cookie_lifetime = 0
// session.cookie_secure = 1
// session.cookie_httponly = 1
// session.cookie_samesite = "Lax"
// session.save_path = "/var/www/sessions"
```

### ะัะตะผั ะถะธะทะฝะธ ัะตััะธะธ

```php
<?php
// ะัะตะผั ะถะธะทะฝะธ ัะตััะธะธ ะฝะฐ ัะตัะฒะตัะต (ะฒ ัะตะบัะฝะดะฐั)
// ะะพ ัะผะพะปัะฐะฝะธั: 1440 ัะตะบัะฝะด (24 ะผะธะฝััั)
ini_set('session.gc_maxlifetime', 3600);  // 1 ัะฐั

// ะัะตะผั ะถะธะทะฝะธ cookie ัะตััะธะธ
ini_set('session.cookie_lifetime', 0);  // 0 = ะดะพ ะทะฐะบัััะธั ะฑัะฐัะทะตัะฐ

// ะะปะธ ะดะปั ะบะพะฝะบัะตัะฝะพะน ัะตััะธะธ (ะฟะพะปัะทะพะฒะฐัะตะปััะบะพะต ะฒัะตะผั ะธััะตัะตะฝะธั)
session_start();
$_SESSION['expires'] = time() + 3600;  // 1 ัะฐั

// ะัะพะฒะตัะบะฐ ะฟัะธ ะบะฐะถะดะพะผ ะทะฐะฟัะพัะต
session_start();
if (isset($_SESSION['expires']) && $_SESSION['expires'] < time()) {
    // ะกะตััะธั ะธััะตะบะปะฐ
    session_destroy();
    header('Location: /login');
    exit;
}
// ะะฑะฝะพะฒะธัั ะฒัะตะผั
$_SESSION['expires'] = time() + 3600;
```

### ะัะฐะบัะธัะตัะบะธะน ะฟัะธะผะตั: ัะธััะตะผะฐ ะฐะฒัะพัะธะทะฐัะธะธ

```php
<?php
// auth.php โ ััะฝะบัะธะธ ะฐะฒัะพัะธะทะฐัะธะธ

function startSecureSession(): void {
    if (session_status() === PHP_SESSION_NONE) {
        session_set_cookie_params([
            'lifetime' => 0,
            'path' => '/',
            'secure' => true,
            'httponly' => true,
            'samesite' => 'Lax',
        ]);
        session_start();
    }
}

function login(int $userId, string $username): void {
    // ะะตะณะตะฝะตัะฐัะธั ID ะดะปั ะทะฐัะธัั ะพั session fixation
    session_regenerate_id(true);
    
    $_SESSION['user_id'] = $userId;
    $_SESSION['username'] = $username;
    $_SESSION['login_time'] = time();
    $_SESSION['ip'] = $_SERVER['REMOTE_ADDR'];
    $_SESSION['user_agent'] = $_SERVER['HTTP_USER_AGENT'];
}

function isLoggedIn(): bool {
    if (!isset($_SESSION['user_id'])) {
        return false;
    }
    
    // ะัะพะฒะตัะบะฐ IP (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะผะพะถะตั ะผะตัะฐัั ะผะพะฑะธะปัะฝัะผ)
    // if ($_SESSION['ip'] !== $_SERVER['REMOTE_ADDR']) {
    //     logout();
    //     return false;
    // }
    
    // ะัะพะฒะตัะบะฐ User-Agent
    if ($_SESSION['user_agent'] !== $_SERVER['HTTP_USER_AGENT']) {
        logout();
        return false;
    }
    
    return true;
}

function getCurrentUser(): ?array {
    if (!isLoggedIn()) {
        return null;
    }
    
    return [
        'id' => $_SESSION['user_id'],
        'username' => $_SESSION['username'],
    ];
}

function requireLogin(): void {
    if (!isLoggedIn()) {
        header('Location: /login.php');
        exit;
    }
}

function logout(): void {
    $_SESSION = [];
    
    if (ini_get('session.use_cookies')) {
        $params = session_get_cookie_params();
        setcookie(session_name(), '', time() - 3600, $params['path'], 
                  $params['domain'], $params['secure'], $params['httponly']);
    }
    
    session_destroy();
}

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒ login.php
startSecureSession();

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $username = trim($_POST['username'] ?? '');
    $password = $_POST['password'] ?? '';
    
    // ะัะพะฒะตัะบะฐ ะฒ ะะ (ัะฟัะพััะฝะฝะพ)
    $user = findUserByUsername($username);
    
    if ($user && password_verify($password, $user['password_hash'])) {
        login($user['id'], $user['username']);
        header('Location: /dashboard.php');
        exit;
    } else {
        $error = 'ะะตะฒะตัะฝัะน ะปะพะณะธะฝ ะธะปะธ ะฟะฐัะพะปั';
    }
}

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒ protected.php
startSecureSession();
requireLogin();

$user = getCurrentUser();
echo "ะัะธะฒะตั, " . htmlspecialchars($user['username']);
```

### Flash-ัะพะพะฑัะตะฝะธั

```php
<?php
// Flash-ัะพะพะฑัะตะฝะธั โ ะดะฐะฝะฝัะต, ะบะพัะพััะต ะถะธะฒัั ัะพะปัะบะพ ะดะพ ัะปะตะดัััะตะณะพ ะทะฐะฟัะพัะฐ

function setFlash(string $key, string $message): void {
    $_SESSION['flash'][$key] = $message;
}

function getFlash(string $key): ?string {
    $message = $_SESSION['flash'][$key] ?? null;
    unset($_SESSION['flash'][$key]);
    return $message;
}

function hasFlash(string $key): bool {
    return isset($_SESSION['flash'][$key]);
}

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต
// ะ ะพะฑัะฐะฑะพััะธะบะต ัะพัะผั:
session_start();
setFlash('success', 'ะะฐะฝะฝัะต ััะฟะตัะฝะพ ัะพััะฐะฝะตะฝั!');
header('Location: /profile.php');
exit;

// ะะฐ ัััะฐะฝะธัะต profile.php:
session_start();
if ($message = getFlash('success')) {
    echo '<div class="alert alert-success">' . htmlspecialchars($message) . '</div>';
}
```

---

## 7. ะะฑัะฐะฑะพัะบะฐ ัะพัะผ

### ะะพะปะฝัะน ัะธะบะป ะพะฑัะฐะฑะพัะบะธ ัะพัะผั

```php
<?php
// contact.php โ ัะพัะผะฐ ะพะฑัะฐัะฝะพะน ัะฒัะทะธ

session_start();

$errors = [];
$success = false;
$old = [
    'name' => '',
    'email' => '',
    'message' => '',
];

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // CSRF ะทะฐัะธัะฐ
    if (!isset($_POST['csrf_token']) || $_POST['csrf_token'] !== $_SESSION['csrf_token']) {
        die('CSRF token mismatch');
    }
    
    // ะะพะปััะตะฝะธะต ะธ ะพัะธััะบะฐ ะดะฐะฝะฝัั
    $old['name'] = trim($_POST['name'] ?? '');
    $old['email'] = trim($_POST['email'] ?? '');
    $old['message'] = trim($_POST['message'] ?? '');
    
    // ะะฐะปะธะดะฐัะธั
    if (empty($old['name'])) {
        $errors['name'] = 'ะะฒะตะดะธัะต ะธะผั';
    } elseif (mb_strlen($old['name']) < 2) {
        $errors['name'] = 'ะะผั ัะปะธัะบะพะผ ะบะพัะพัะบะพะต';
    }
    
    if (empty($old['email'])) {
        $errors['email'] = 'ะะฒะตะดะธัะต email';
    } elseif (!filter_var($old['email'], FILTER_VALIDATE_EMAIL)) {
        $errors['email'] = 'ะะตะบะพััะตะบัะฝัะน email';
    }
    
    if (empty($old['message'])) {
        $errors['message'] = 'ะะฒะตะดะธัะต ัะพะพะฑัะตะฝะธะต';
    } elseif (mb_strlen($old['message']) < 10) {
        $errors['message'] = 'ะกะพะพะฑัะตะฝะธะต ัะปะธัะบะพะผ ะบะพัะพัะบะพะต';
    }
    
    // ะัะปะธ ะพัะธะฑะพะบ ะฝะตั โ ะพะฑัะฐะฑะพัะบะฐ
    if (empty($errors)) {
        // ะัะฟัะฐะฒะบะฐ email, ัะพััะฐะฝะตะฝะธะต ะฒ ะะ ะธ ั.ะด.
        // ...
        
        $success = true;
        $old = ['name' => '', 'email' => '', 'message' => ''];
    }
}

// ะะตะฝะตัะฐัะธั CSRF ัะพะบะตะฝะฐ
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>ะะฑัะฐัะฝะฐั ัะฒัะทั</title>
</head>
<body>
    <h1>ะะฑัะฐัะฝะฐั ัะฒัะทั</h1>
    
    <?php if ($success): ?>
        <div class="success">ะกะพะพะฑัะตะฝะธะต ะพัะฟัะฐะฒะปะตะฝะพ!</div>
    <?php endif; ?>
    
    <form method="POST" action="">
        <input type="hidden" name="csrf_token" value="<?= $_SESSION['csrf_token'] ?>">
        
        <div>
            <label>ะะผั:</label>
            <input type="text" name="name" value="<?= htmlspecialchars($old['name']) ?>">
            <?php if (isset($errors['name'])): ?>
                <span class="error"><?= htmlspecialchars($errors['name']) ?></span>
            <?php endif; ?>
        </div>
        
        <div>
            <label>Email:</label>
            <input type="email" name="email" value="<?= htmlspecialchars($old['email']) ?>">
            <?php if (isset($errors['email'])): ?>
                <span class="error"><?= htmlspecialchars($errors['email']) ?></span>
            <?php endif; ?>
        </div>
        
        <div>
            <label>ะกะพะพะฑัะตะฝะธะต:</label>
            <textarea name="message"><?= htmlspecialchars($old['message']) ?></textarea>
            <?php if (isset($errors['message'])): ?>
                <span class="error"><?= htmlspecialchars($errors['message']) ?></span>
            <?php endif; ?>
        </div>
        
        <button type="submit">ะัะฟัะฐะฒะธัั</button>
    </form>
</body>
</html>
```

### PRG Pattern (Post-Redirect-Get)

```php
<?php
// ะัะพะฑะปะตะผะฐ: ะฟัะธ ะพะฑะฝะพะฒะปะตะฝะธะธ ัััะฐะฝะธัั ะฟะพัะปะต POST ัะพัะผะฐ ะพัะฟัะฐะฒะปัะตััั ะฟะพะฒัะพัะฝะพ
// ะะตัะตะฝะธะต: PRG Pattern

// form-handler.php
session_start();

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // ะะฐะปะธะดะฐัะธั ะธ ะพะฑัะฐะฑะพัะบะฐ...
    
    if (empty($errors)) {
        // ะฃัะฟะตั: ัะพััะฐะฝัะตะผ ัะพะพะฑัะตะฝะธะต ะธ ัะตะดะธัะตะบัะธะผ
        setFlash('success', 'ะะฐะฝะฝัะต ัะพััะฐะฝะตะฝั!');
        header('Location: /success.php');
        exit;  // ะะฐะถะฝะพ!
    } else {
        // ะัะธะฑะบะธ: ัะพััะฐะฝัะตะผ ะฒ ัะตััะธั ะธ ัะตะดะธัะตะบัะธะผ ะพะฑัะฐัะฝะพ
        $_SESSION['form_errors'] = $errors;
        $_SESSION['form_old'] = $_POST;
        header('Location: /form.php');
        exit;
    }
}

// form.php
session_start();
$errors = $_SESSION['form_errors'] ?? [];
$old = $_SESSION['form_old'] ?? [];
unset($_SESSION['form_errors'], $_SESSION['form_old']);

// ะะพะบะฐะทัะฒะฐะตะผ ัะพัะผั ั $errors ะธ $old...
```

---

## 8. ะะตะทะพะฟะฐัะฝะพััั

### CSRF (Cross-Site Request Forgery)

```php
<?php
// CSRF โ ะฐัะฐะบะฐ, ะบะพะณะดะฐ ะทะปะพัะผััะปะตะฝะฝะธะบ ะทะฐััะฐะฒะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปั
// ะฒัะฟะพะปะฝะธัั ะดะตะนััะฒะธะต ะฝะฐ ัะฐะนัะต, ะณะดะต ัะพั ะฐะฒัะพัะธะทะพะฒะฐะฝ

// ะัะธะผะตั ะฐัะฐะบะธ: ะฝะฐ ัะฐะนัะต evil.com ัะฐะทะผะตััะฝ ะบะพะด:
// <img src="https://bank.com/transfer?to=hacker&amount=1000">
// ะะพะณะดะฐ ะถะตััะฒะฐ ะพัะบััะฒะฐะตั evil.com, ะตั ะฑัะฐัะทะตั ะพัะฟัะฐะฒะปัะตั ะทะฐะฟัะพั
// ะฝะฐ bank.com ั ะตั cookies!

// ะะฐัะธัะฐ: CSRF ัะพะบะตะฝ
class CsrfProtection {
    public static function generateToken(): string {
        if (empty($_SESSION['csrf_token'])) {
            $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
        }
        return $_SESSION['csrf_token'];
    }
    
    public static function getTokenField(): string {
        $token = self::generateToken();
        return '<input type="hidden" name="csrf_token" value="' . $token . '">';
    }
    
    public static function verify(): bool {
        $token = $_POST['csrf_token'] ?? $_SERVER['HTTP_X_CSRF_TOKEN'] ?? '';
        return hash_equals($_SESSION['csrf_token'] ?? '', $token);
    }
    
    public static function verifyOrDie(): void {
        if (!self::verify()) {
            http_response_code(403);
            die('CSRF token validation failed');
        }
    }
}

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒ ัะพัะผะต
session_start();
?>
<form method="POST">
    <?= CsrfProtection::getTokenField() ?>
    <input name="data">
    <button>Submit</button>
</form>

<?php
// ะ ะพะฑัะฐะฑะพััะธะบะต
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    CsrfProtection::verifyOrDie();
    // ะะฑัะฐะฑะพัะบะฐ ัะพัะผั...
}
```

### Session Fixation

```php
<?php
// Session Fixation โ ะฐัะฐะบะฐ, ะบะพะณะดะฐ ะทะปะพัะผััะปะตะฝะฝะธะบ ะฝะฐะฒัะทัะฒะฐะตั ะถะตััะฒะต
// ะธะทะฒะตััะฝัะน ะตะผั session ID

// ะัะฐะบะฐ:
// 1. ะฅะฐะบะตั ะฟะพะปััะฐะตั session ID: http://site.com/?PHPSESSID=known123
// 2. ะัะฟัะฐะฒะปัะตั ัััะปะบั ะถะตััะฒะต
// 3. ะะตััะฒะฐ ะปะพะณะธะฝะธััั ั ััะธะผ session ID
// 4. ะฅะฐะบะตั ะธัะฟะพะปัะทัะตั known123 ััะพะฑั ะฒะพะนัะธ ะบะฐะบ ะถะตััะฒะฐ

// ะะฐัะธัะฐ: ัะตะณะตะฝะตัะฐัะธั session ID ะฟัะธ ะปะพะณะธะฝะต
function secureLogin(int $userId): void {
    // ะฃะฝะธััะพะถะธัั ััะฐััั ัะตััะธั
    session_regenerate_id(true);  // true = ัะดะฐะปะธัั ััะฐััะน ัะฐะนะป
    
    // ะะฐะฟะธัะฐัั ะดะฐะฝะฝัะต ะฒ ะฝะพะฒัั ัะตััะธั
    $_SESSION['user_id'] = $userId;
    $_SESSION['created_at'] = time();
}

// ะขะฐะบะถะต ัะตะณะตะฝะตัะธัะพะฒะฐัั ะฟะตัะธะพะดะธัะตัะบะธ
session_start();

if (isset($_SESSION['created_at']) && $_SESSION['created_at'] < time() - 1800) {
    // ะะฐะถะดัะต 30 ะผะธะฝัั
    session_regenerate_id(true);
    $_SESSION['created_at'] = time();
}
```

### Session Hijacking

```php
<?php
// Session Hijacking โ ะบัะฐะถะฐ session ID (ัะตัะตะท XSS, ัะฝะธััะธะฝะณ ะธ ั.ะด.)

// ะะฐัะธัะฐ:

// 1. HttpOnly cookies (ะฝะตะดะพัััะฟะฝั ะธะท JavaScript)
session_set_cookie_params(['httponly' => true]);

// 2. Secure cookies (ัะพะปัะบะพ ัะตัะตะท HTTPS)
session_set_cookie_params(['secure' => true]);

// 3. ะัะธะฒัะทะบะฐ ะบ User-Agent
$_SESSION['user_agent'] = $_SERVER['HTTP_USER_AGENT'];

// ะัะธ ะบะฐะถะดะพะผ ะทะฐะฟัะพัะต:
if ($_SESSION['user_agent'] !== $_SERVER['HTTP_USER_AGENT']) {
    session_destroy();
    die('Session expired');
}

// 4. ะัะธะฒัะทะบะฐ ะบ IP (ะพััะพัะพะถะฝะพ โ ะผะพะถะตั ะผะตะฝััััั)
// $_SESSION['ip'] = $_SERVER['REMOTE_ADDR'];

// 5. ะะพัะพัะบะพะต ะฒัะตะผั ะถะธะทะฝะธ ัะตััะธะธ
ini_set('session.gc_maxlifetime', 1800);  // 30 ะผะธะฝัั

// 6. ะะตะณัะปััะฝะฐั ัะตะณะตะฝะตัะฐัะธั ID
session_regenerate_id(true);
```

### ะะฐัะธัะฐ ะพั XSS ะฒ ะฒัะฒะพะดะต

```php
<?php
// XSS โ ะฒะฝะตะดัะตะฝะธะต ะฒัะตะดะพะฝะพัะฝะพะณะพ JavaScript

// โ ะะะะกะะ!
echo $_GET['search'];
echo $_SESSION['username'];

// โ ะะะะะะะกะะ โ ะฒัะตะณะดะฐ ัะบัะฐะฝะธััะน ะฒัะฒะพะด!
echo htmlspecialchars($_GET['search'], ENT_QUOTES, 'UTF-8');

// ะคัะฝะบัะธั-ะฟะพะผะพัะฝะธะบ
function e(string $str): string {
    return htmlspecialchars($str, ENT_QUOTES, 'UTF-8');
}

echo e($_GET['search']);
echo e($_SESSION['username']);

// ะ ัะฐะฑะปะพะฝะฐั (ะบะพัะพัะบะธะน ัะธะฝัะฐะบัะธั)
?>
<p>ะะพะธัะบ: <?= e($_GET['search'] ?? '') ?></p>
<p>ะัะธะฒะตั, <?= e($_SESSION['username'] ?? 'ะะพััั') ?>!</p>
```

### Content Security Policy

```php
<?php
// CSP โ ะทะฐะณะพะปะพะฒะพะบ, ะพะณัะฐะฝะธัะธะฒะฐััะธะน ะธััะพัะฝะธะบะธ ัะบัะธะฟัะพะฒ

// ะะฐะทะพะฒัะน CSP (ัะพะปัะบะพ ัะฒะพะธ ัะบัะธะฟัั)
header("Content-Security-Policy: default-src 'self'");

// ะะฐะทัะตัะธัั inline ัะบัะธะฟัั (ะผะตะฝะตะต ะฑะตะทะพะฟะฐัะฝะพ)
header("Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'");

// ะะฐะทัะตัะธัั ัะบัะธะฟัั ั CDN
header("Content-Security-Policy: default-src 'self'; script-src 'self' https://cdn.jsdelivr.net");

// ะขะพะปัะบะพ ะพััััั (ะฝะต ะฑะปะพะบะธััะตั)
header("Content-Security-Policy-Report-Only: default-src 'self'; report-uri /csp-report");
```

---

## 9. ะัะฐะบัะธัะตัะบะธะต ะฟัะธะผะตัั

### ะัะธะผะตั 1: ะะพัะทะธะฝะฐ ะฟะพะบัะฟะพะบ

```php
<?php
// cart.php โ ะบะพัะทะธะฝะฐ ะฝะฐ ัะตััะธัั

session_start();

// ะะฝะธัะธะฐะปะธะทะฐัะธั ะบะพัะทะธะฝั
if (!isset($_SESSION['cart'])) {
    $_SESSION['cart'] = [];
}

function addToCart(int $productId, int $quantity = 1): void {
    if (isset($_SESSION['cart'][$productId])) {
        $_SESSION['cart'][$productId] += $quantity;
    } else {
        $_SESSION['cart'][$productId] = $quantity;
    }
}

function removeFromCart(int $productId): void {
    unset($_SESSION['cart'][$productId]);
}

function updateCartQuantity(int $productId, int $quantity): void {
    if ($quantity <= 0) {
        removeFromCart($productId);
    } else {
        $_SESSION['cart'][$productId] = $quantity;
    }
}

function getCart(): array {
    return $_SESSION['cart'];
}

function getCartCount(): int {
    return array_sum($_SESSION['cart']);
}

function clearCart(): void {
    $_SESSION['cart'] = [];
}

function getCartTotal(array $products): float {
    $total = 0;
    foreach ($_SESSION['cart'] as $productId => $quantity) {
        if (isset($products[$productId])) {
            $total += $products[$productId]['price'] * $quantity;
        }
    }
    return $total;
}

// ะะฑัะฐะฑะพัะบะฐ ะดะตะนััะฒะธะน
$action = $_POST['action'] ?? $_GET['action'] ?? '';

switch ($action) {
    case 'add':
        $productId = (int) ($_POST['product_id'] ?? 0);
        if ($productId > 0) {
            addToCart($productId);
            setFlash('success', 'ะขะพะฒะฐั ะดะพะฑะฐะฒะปะตะฝ ะฒ ะบะพัะทะธะฝั');
        }
        header('Location: ' . $_SERVER['HTTP_REFERER']);
        exit;
        
    case 'remove':
        $productId = (int) ($_GET['product_id'] ?? 0);
        removeFromCart($productId);
        header('Location: /cart.php');
        exit;
        
    case 'update':
        foreach ($_POST['quantities'] ?? [] as $productId => $quantity) {
            updateCartQuantity((int) $productId, (int) $quantity);
        }
        header('Location: /cart.php');
        exit;
        
    case 'clear':
        clearCart();
        header('Location: /cart.php');
        exit;
}
```

### ะัะธะผะตั 2: Rate Limiting

```php
<?php
// rate-limiter.php โ ะพะณัะฐะฝะธัะตะฝะธะต ะบะพะปะธัะตััะฒะฐ ะทะฐะฟัะพัะพะฒ

class RateLimiter {
    private int $maxAttempts;
    private int $decayMinutes;
    private string $prefix;
    
    public function __construct(int $maxAttempts = 5, int $decayMinutes = 1) {
        $this->maxAttempts = $maxAttempts;
        $this->decayMinutes = $decayMinutes;
        $this->prefix = 'rate_limit_';
    }
    
    public function attempt(string $key): bool {
        $sessionKey = $this->prefix . md5($key);
        
        if (!isset($_SESSION[$sessionKey])) {
            $_SESSION[$sessionKey] = [
                'attempts' => 0,
                'reset_at' => time() + ($this->decayMinutes * 60),
            ];
        }
        
        // ะกะฑัะพั ะตัะปะธ ะฒัะตะผั ะธััะตะบะปะพ
        if ($_SESSION[$sessionKey]['reset_at'] <= time()) {
            $_SESSION[$sessionKey] = [
                'attempts' => 0,
                'reset_at' => time() + ($this->decayMinutes * 60),
            ];
        }
        
        // ะัะพะฒะตัะบะฐ ะปะธะผะธัะฐ
        if ($_SESSION[$sessionKey]['attempts'] >= $this->maxAttempts) {
            return false;
        }
        
        // ะฃะฒะตะปะธัะธัั ัััััะธะบ
        $_SESSION[$sessionKey]['attempts']++;
        return true;
    }
    
    public function remaining(string $key): int {
        $sessionKey = $this->prefix . md5($key);
        $attempts = $_SESSION[$sessionKey]['attempts'] ?? 0;
        return max(0, $this->maxAttempts - $attempts);
    }
    
    public function resetAt(string $key): int {
        $sessionKey = $this->prefix . md5($key);
        return $_SESSION[$sessionKey]['reset_at'] ?? time();
    }
    
    public function clear(string $key): void {
        $sessionKey = $this->prefix . md5($key);
        unset($_SESSION[$sessionKey]);
    }
}

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะดะปั ะทะฐัะธัั ะปะพะณะธะฝะฐ
session_start();

$limiter = new RateLimiter(5, 15);  // 5 ะฟะพะฟััะพะบ ะทะฐ 15 ะผะธะฝัั
$key = 'login_' . $_SERVER['REMOTE_ADDR'];

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if (!$limiter->attempt($key)) {
        $waitMinutes = ceil(($limiter->resetAt($key) - time()) / 60);
        die("ะกะปะธัะบะพะผ ะผะฝะพะณะพ ะฟะพะฟััะพะบ. ะะพะดะพะถะดะธัะต $waitMinutes ะผะธะฝัั.");
    }
    
    // ะะพะฟััะบะฐ ะปะพะณะธะฝะฐ...
    if ($loginSuccess) {
        $limiter->clear($key);  // ะกะฑัะพัะธัั ะฟัะธ ััะฟะตัะต
        // ...
    }
}

echo "ะััะฐะปะพัั ะฟะพะฟััะพะบ: " . $limiter->remaining($key);
```

### ะัะธะผะตั 3: ะะฐัััะพะนะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั

```php
<?php
// settings.php โ ััะฐะฝะตะฝะธะต ะฝะฐัััะพะตะบ ะฒ cookies

class UserSettings {
    private array $defaults = [
        'theme' => 'light',
        'language' => 'ru',
        'items_per_page' => 20,
        'sidebar_collapsed' => false,
    ];
    
    private array $settings;
    
    public function __construct() {
        $this->settings = $this->defaults;
        $this->loadFromCookie();
    }
    
    private function loadFromCookie(): void {
        if (isset($_COOKIE['user_settings'])) {
            $decoded = json_decode($_COOKIE['user_settings'], true);
            if (is_array($decoded)) {
                $this->settings = array_merge($this->defaults, $decoded);
            }
        }
    }
    
    public function get(string $key, mixed $default = null): mixed {
        return $this->settings[$key] ?? $default;
    }
    
    public function set(string $key, mixed $value): self {
        if (array_key_exists($key, $this->defaults)) {
            $this->settings[$key] = $value;
            $this->saveToCookie();
        }
        return $this;
    }
    
    public function all(): array {
        return $this->settings;
    }
    
    private function saveToCookie(): void {
        $json = json_encode($this->settings);
        setcookie('user_settings', $json, [
            'expires' => time() + 86400 * 365,  // 1 ะณะพะด
            'path' => '/',
            'secure' => true,
            'httponly' => true,
            'samesite' => 'Lax',
        ]);
    }
    
    public function reset(): void {
        $this->settings = $this->defaults;
        setcookie('user_settings', '', time() - 3600, '/');
    }
}

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต
$settings = new UserSettings();

// ะะพะปััะตะฝะธะต
$theme = $settings->get('theme');
$lang = $settings->get('language');

// ะะทะผะตะฝะตะฝะธะต
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $settings->set('theme', $_POST['theme'] ?? 'light');
    $settings->set('items_per_page', (int) ($_POST['items_per_page'] ?? 20));
    header('Location: /settings.php');
    exit;
}
?>
<form method="POST">
    <select name="theme">
        <option value="light" <?= $settings->get('theme') === 'light' ? 'selected' : '' ?>>ะกะฒะตัะปะฐั</option>
        <option value="dark" <?= $settings->get('theme') === 'dark' ? 'selected' : '' ?>>ะขัะผะฝะฐั</option>
    </select>
    <button>ะกะพััะฐะฝะธัั</button>
</form>
```

---

## 10. ะฃะฟัะฐะถะฝะตะฝะธั

### ะฃะฟัะฐะถะฝะตะฝะธะต 1: ะกััััะธะบ ะฟะพัะตัะตะฝะธะน (15 ะผะธะฝัั)

```php
<?php
// ะกะพะทะดะฐะน ัััััะธะบ ะฟะพัะตัะตะฝะธะน ัััะฐะฝะธัั:
// 1. ะะฑัะธะน ัััััะธะบ (ะฒ ัะฐะนะปะต) โ ัะบะพะปัะบะพ ะฒัะตะณะพ ะฟัะพัะผะพััะพะฒ
// 2. ะกััััะธะบ ัะตััะธะธ โ ัะบะพะปัะบะพ ัะฐะท ัะตะบััะธะน ะฟะพะปัะทะพะฒะฐัะตะปั ะพะฑะฝะพะฒะธะป ัััะฐะฝะธัั
// 3. ะฃะฝะธะบะฐะปัะฝัะต ะฟะพัะตัะธัะตะปะธ (ัะตัะตะท cookies) โ ัะบะพะปัะบะพ ัะฐะทะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

// ะัะฒะพะด:
// ะัะตะณะพ ะฟัะพัะผะพััะพะฒ: 1234
// ะะฐัะธั ะฟัะพัะผะพััะพะฒ ะทะฐ ัะตััะธั: 5
// ะฃะฝะธะบะฐะปัะฝัั ะฟะพัะตัะธัะตะปะตะน: 456
```

### ะฃะฟัะฐะถะฝะตะฝะธะต 2: ะคะพัะผะฐ ั ะฒะฐะปะธะดะฐัะธะตะน (25 ะผะธะฝัั)

```php
<?php
// ะกะพะทะดะฐะน ัะพัะผั ัะตะณะธัััะฐัะธะธ:
// - ะะผั (2-50 ัะธะผะฒะพะปะพะฒ, ัะพะปัะบะพ ะฑัะบะฒั ะธ ะฟัะพะฑะตะปั)
// - Email (ะฒะฐะปะธะดะฝัะน ัะพัะผะฐั, ัะฝะธะบะฐะปัะฝัะน)
// - ะะฐัะพะปั (ะผะธะฝะธะผัะผ 8 ัะธะผะฒะพะปะพะฒ, ะฑัะบะฒั ะธ ัะธััั)
// - ะะพะดัะฒะตัะถะดะตะฝะธะต ะฟะฐัะพะปั

// ะขัะตะฑะพะฒะฐะฝะธั:
// - CSRF ะทะฐัะธัะฐ
// - ะกะพััะฐะฝะตะฝะธะต ะฒะฒะตะดัะฝะฝัั ะดะฐะฝะฝัั ะฟัะธ ะพัะธะฑะบะต
// - ะัะฒะพะด ะพัะธะฑะพะบ ะฟะพะด ะบะฐะถะดัะผ ะฟะพะปะตะผ
// - PRG pattern ะฟะพัะปะต ััะฟะตัะฝะพะน ัะตะณะธัััะฐัะธะธ
```

### ะฃะฟัะฐะถะฝะตะฝะธะต 3: ะกะธััะตะผะฐ "ะะทะฑัะฐะฝะฝะพะต" (20 ะผะธะฝัั)

```php
<?php
// ะกะพะทะดะฐะน ัะธััะตะผั ะธะทะฑัะฐะฝะฝัั ัะพะฒะฐัะพะฒ:
// 1. ะะปั ะฝะตะฐะฒัะพัะธะทะพะฒะฐะฝะฝัั โ ััะฐะฝะตะฝะธะต ะฒ cookies (ะผะฐะบัะธะผัะผ 10 ัะพะฒะฐัะพะฒ)
// 2. ะะปั ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัั โ ััะฐะฝะตะฝะธะต ะฒ ัะตััะธะธ
// 3. ะคัะฝะบัะธะธ: ะดะพะฑะฐะฒะธัั, ัะดะฐะปะธัั, ะฟัะพะฒะตัะธัั ะฝะฐะปะธัะธะต, ะฟะพะปััะธัั ัะฟะธัะพะบ
// 4. ะัะธ ะปะพะณะธะฝะต โ ะฟะตัะตะฝะพั ะธะทะฑัะฐะฝะฝะพะณะพ ะธะท cookies ะฒ ัะตััะธั
```

### ะฃะฟัะฐะถะฝะตะฝะธะต 4: API ั ะฐะฒัะพัะธะทะฐัะธะตะน (30 ะผะธะฝัั)

```php
<?php
// ะกะพะทะดะฐะน ะฟัะพััะพะน JSON API:
// - POST /api/login โ ะฟะพะปััะธัั ัะพะบะตะฝ
// - GET /api/profile โ ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั (ััะตะฑัะตั ัะพะบะตะฝ)
// - PUT /api/profile โ ะพะฑะฝะพะฒะธัั ะดะฐะฝะฝัะต (ััะตะฑัะตั ัะพะบะตะฝ)
// - POST /api/logout โ ะธะฝะฒะฐะปะธะดะธัะพะฒะฐัั ัะพะบะตะฝ

// ะขัะตะฑะพะฒะฐะฝะธั:
// - ะขะพะบะตะฝ ะฟะตัะตะดะฐัััั ัะตัะตะท ะทะฐะณะพะปะพะฒะพะบ Authorization: Bearer <token>
// - ะขะพะบะตะฝ ััะฐะฝะธััั ะฒ ัะตััะธะธ
// - Rate limiting: 100 ะทะฐะฟัะพัะพะฒ ะฒ ะผะธะฝััั
```

---

## 11. ะะพะฟัะพัั ะดะปั ัะฐะผะพะฟัะพะฒะตัะบะธ

1. **ะงะตะผ ะพัะปะธัะฐะตััั GET ะพั POST?**

2. **ะะพัะตะผั ะฝะตะปัะทั ััะฐะฝะธัั ะฟะฐัะพะปะธ ะฒ cookies?**

3. **ะงัะพ ัะฐะบะพะต CSRF ะธ ะบะฐะบ ะพั ะฝะตะณะพ ะทะฐัะธัะธัััั?**

4. **ะะฐัะตะผ ะฒัะทัะฒะฐัั `session_regenerate_id()` ะฟะพัะปะต ะปะพะณะธะฝะฐ?**

5. **ะงัะพ ะฟัะพะธะทะพะนะดัั, ะตัะปะธ ะฒัะทะฒะฐัั `header()` ะฟะพัะปะต ะฒัะฒะพะดะฐ HTML?**

6. **ะะฐะบ ะฟัะพะฒะตัะธัั, ััะพ ะทะฐะฟัะพั ะฟัะธััะป ัะตัะตะท AJAX?**

7. **ะงัะพ ัะฐะบะพะต SameSite cookie ะธ ะทะฐัะตะผ ะพะฝ ะฝัะถะตะฝ?**

8. **ะะพัะตะผั ะฒะฐะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั `htmlspecialchars()` ะฟัะธ ะฒัะฒะพะดะต ะดะฐะฝะฝัั?**

---

## 12. ะงะฐัััะต ะพัะธะฑะบะธ

### ะัะธะฑะบะฐ 1: Headers already sent

```php
<?php
// โ ะัะธะฑะบะฐ: ะฒัะฒะพะด ะดะพ header()
echo "Hello";
header('Location: /other.php');  // Warning: Cannot modify header information

// โ ะะตัะตะฝะธะต: header() ะดะพ ะปัะฑะพะณะพ ะฒัะฒะพะดะฐ
header('Location: /other.php');
exit;
echo "Hello";  // ะะต ะฒัะฟะพะปะฝะธััั

// โ ะะปะธ ะธัะฟะพะปัะทัะน output buffering
ob_start();
echo "Hello";
// ... ะผะฝะพะณะพ ะบะพะดะฐ ...
header('Location: /other.php');
ob_end_clean();
exit;
```

### ะัะธะฑะบะฐ 2: ะะตั exit ะฟะพัะปะต redirect

```php
<?php
// โ ะะพะด ะฟัะพะดะพะปะถะฐะตั ะฒัะฟะพะปะฝััััั!
if (!$isLoggedIn) {
    header('Location: /login.php');
}
// ะญัะพั ะบะพะด ะฒัะฟะพะปะฝะธััั ะดะปั ะฝะตะฐะฒัะพัะธะทะพะฒะฐะฝะฝัั!
showSecretData();

// โ ะัะตะณะดะฐ exit ะฟะพัะปะต redirect
if (!$isLoggedIn) {
    header('Location: /login.php');
    exit;
}
showSecretData();
```

### ะัะธะฑะบะฐ 3: ะะพะฒะตัะธะต ะดะฐะฝะฝัะผ ะธะท cookies

```php
<?php
// โ ะะะะกะะ! ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะธะทะผะตะฝะธัั cookies
$isAdmin = $_COOKIE['is_admin'] ?? false;
if ($isAdmin) {
    showAdminPanel();
}

// โ ะฅัะฐะฝะธ ะฒะฐะถะฝัะต ะดะฐะฝะฝัะต ะฒ ัะตััะธะธ
if ($_SESSION['role'] === 'admin') {
    showAdminPanel();
}
```

### ะัะธะฑะบะฐ 4: ะะตั CSRF ะทะฐัะธัั

```php
<?php
// โ ะคะพัะผะฐ ะฑะตะท CSRF ัะพะบะตะฝะฐ
// ะะปะพัะผััะปะตะฝะฝะธะบ ะผะพะถะตั ะทะฐััะฐะฒะธัั ะฟะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะธัั ัะพัะผั
<form method="POST" action="/delete-account">
    <button>ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั</button>
</form>

// โ ะก CSRF ัะพะบะตะฝะพะผ
<form method="POST" action="/delete-account">
    <input type="hidden" name="csrf_token" value="<?= $_SESSION['csrf_token'] ?>">
    <button>ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั</button>
</form>

<?php
// ะ ะฟัะพะฒะตัะบะฐ ะฝะฐ ัะตัะฒะตัะต
if ($_POST['csrf_token'] !== $_SESSION['csrf_token']) {
    die('Invalid CSRF token');
}
```

### ะัะธะฑะบะฐ 5: XSS ัะตัะตะท ะฒัะฒะพะด ะดะฐะฝะฝัั

```php
<?php
// โ XSS ััะทะฒะธะผะพััั!
echo "ะัะธะฒะตั, " . $_GET['name'];
// URL: ?name=<script>alert('XSS')</script>

// โ ะญะบัะฐะฝะธัะพะฒะฐะฝะธะต
echo "ะัะธะฒะตั, " . htmlspecialchars($_GET['name'] ?? '', ENT_QUOTES, 'UTF-8');
```

---

## ะะตะทัะผะต ะณะปะฐะฒั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      ะะะะะะะ ะะะะะะะ                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ  HTTP ะะะขะะะซ                                                   โ
โ  โข GET โ ะฟะพะปััะตะฝะธะต ะดะฐะฝะฝัั (ะบะตัะธััะตััั, ะฒ URL)                 โ
โ  โข POST โ ะพัะฟัะฐะฒะบะฐ ะดะฐะฝะฝัั (ะฝะต ะบะตัะธััะตััั, ะฒ ัะตะปะต)             โ
โ                                                                โ
โ  ะกะฃะะะะะะะะะะฌะะซะ ะะะกะกะะะซ                                       โ
โ  โข $_GET โ ะฟะฐัะฐะผะตััั ะธะท URL                                   โ
โ  โข $_POST โ ะดะฐะฝะฝัะต ะธะท ัะพัะผั                                   โ
โ  โข $_COOKIE โ cookies                                         โ
โ  โข $_SESSION โ ะดะฐะฝะฝัะต ัะตััะธะธ                                  โ
โ  โข $_SERVER โ ะธะฝัะพัะผะฐัะธั ะพ ะทะฐะฟัะพัะต                            โ
โ                                                                โ
โ  COOKIES                                                       โ
โ  โข setcookie() ะดะพ ะฒัะฒะพะดะฐ!                                     โ
โ  โข secure=true, httponly=true, samesite='Lax'                 โ
โ  โข ะะฐะฝะฝัะต ััะฐะฝัััั ั ะบะปะธะตะฝัะฐ (ะฝะต ะดะพะฒะตััะน!)                    โ
โ                                                                โ
โ  ะกะะกะกะะ                                                        โ
โ  โข session_start() ะดะพ ะฒัะฒะพะดะฐ!                                 โ
โ  โข session_regenerate_id() ะฟะพัะปะต ะปะพะณะธะฝะฐ                       โ
โ  โข ะะฐะฝะฝัะต ััะฐะฝัััั ะฝะฐ ัะตัะฒะตัะต (ะฑะตะทะพะฟะฐัะฝะพ)                     โ
โ                                                                โ
โ  ะะะะะะะกะะะกะขะฌ                                                  โ
โ  โข CSRF ัะพะบะตะฝั ะดะปั ะฒัะตั ัะพัะผ                                  โ
โ  โข htmlspecialchars() ะดะปั ะฒัะตะณะพ ะฒัะฒะพะดะฐ                        โ
โ  โข exit ะฟะพัะปะต header('Location: ...')                         โ
โ  โข ะะต ะดะพะฒะตััะน ะดะฐะฝะฝัะผ ะธะท $_GET, $_POST, $_COOKIE               โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

**ะกะปะตะดัััะฐั ะณะปะฐะฒะฐ:** `ะะปะฐะฒะฐ 2.2: ะคะพัะผั ะธ ะฒะฐะปะธะดะฐัะธั โ ะพะฑัะฐะฑะพัะบะฐ ัะพัะผ, ัะธะปัััะฐัะธั, ัะฐะฝะธัะธะทะฐัะธั ะดะฐะฝะฝัั`
